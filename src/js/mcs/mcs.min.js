/**
* Copyright (c) 2018, Oracle and/or its affiliates. All rights reserved.
 * Oracle Mobile Cloud Enterprise JavaScript SDK for Cordova, Release: 18.2.1.0, E95445-01
*/



!function(e,t,n,o,r,i,s){var a=null;(function e(t,n,o){function r(s,a){if(!n[s]){if(!t[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(i)return i(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[s]={exports:{}};t[s][0].call(l.exports,function(e){var n=t[s][1][e];return r(n||e)},l,l.exports,e,t,n,o)}return n[s].exports}for(var i="function"==typeof require&&require,s=0;s<o.length;s++)r(o[s]);return r})({1:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.AnalyticsEvent=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=null,this.timestamp=(new Date).toISOString(),this.sessionID=null,this.properties={},this.name=t}},{}],2:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Analytics=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=e("./analytics-event"),i=e("../logger"),s=e("../responses/network-response"),a=e("../types");var u=function(){function e(t,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.backend=t,this.platform=n,this.utils=o,this.events=[],this.logger=new i.Logger("Analytics")}return o(e,[{key:"getSessionId",value:function(){return this.sessionId}},{key:"startSession",value:function(){this.sessionId||(this.sessionId=this.utils.uuid(),this.logNamedEvent("sessionStart").type="system")}},{key:"endSession",value:function(){return this.sessionId?(this.logNamedEvent("sessionEnd").type="system",this.logger.debug("Deactivate a default session"),this.flush().then(function(e){return this.sessionId=void 0,e}.bind(this))):Promise.reject(new s.NetworkResponse(500,"Session ID is null"))}},{key:"logNamedEvent",value:function(e){var t=new r.AnalyticsEvent(e);return this.logEvent(t),t}},{key:"logEvent",value:function(e){return 0===this.events.length&&(this.events[0]=this._createContextEvent()),this.startSession(),this.events[this.events.length]=e,e.sessionID=this.sessionId,e}},{key:"flush",value:function(){for(var e=0;e<this.events.length;e++){if("context"==this.events[e].name){var t=this.platform.getGPSLocation();null!=t&&null!=t.latitude&&(this.events[e].properties.latitude=t.latitude),null!=t&&null!=t.longitude&&(this.events[e].properties.longitude=t.longitude)}}var n=JSON.stringify(this.events),o=this.backend.getHttpHeaders();return o.add(a.HEADERS.CONTENT_TYPE,a.CONTENT_TYPES.APPLICATION_JSON),this.platform.invokeService({method:a.HTTP_METHODS.POST,url:this.backend.getPlatformUrl("analytics/events"),headers:o,data:n,module:a.MODULE_NAMES.MCS_ANALYTICS}).then(function(e){return this.logger.debug("Analytics events flushed."),this.events=[],e}.bind(this),function(e){return this.logger.error("Failed to flush analytics events."),Promise.reject(e)}.bind(this))}},{key:"_createContextEvent",value:function(){var e=new r.AnalyticsEvent("context");e.type="system",e.sessionID=this.sessionId,e.properties.timezone=""+60*(new Date).getTimezoneOffset();var t=this.platform.getDeviceInformation();return e.properties.model=t.model,e.properties.manufacturer=t.manufacturer,e.properties.osName=t.osName,e.properties.osVersion=t.osVersion,e.properties.osBuild=t.osBuild,e.properties.carrier=t.carrier,e}},{key:"_getEvents",value:function(){return this.events}}]),e}();n.Analytics=u},{"../logger":13,"../responses/network-response":21,"../types":41,"./analytics-event":1}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Authorization=n.AuthenticationResponse=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=e("../logger"),i=e("../responses/network-response"),s=e("../types");function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var u=n.AuthenticationResponse=function(e){function t(e,n){a(this,t);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.statusCode,e.data,e.headers));return o.accessToken=n,o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.NetworkResponse),t}(),c=function(){function e(t,n){a(this,e),this.utils=t,this.platform=n,this._onAuthenticationCallbacks=[],this.logger=new r.Logger("Authorization")}return o(e,[{key:"getAccessToken",value:function(){return this._accessToken}},{key:"_setAccessToken",value:function(e){this._accessToken=e}},{key:"_getIsAnonymous",value:function(){return this._isAnonymous}},{key:"_getIsAuthorized",value:function(){return this._isAuthorized}},{key:"_getAnonymousAccessToken",value:function(){return this._anonymousAccessToken}},{key:"_authenticateAnonymousInvoke",value:function(e,t,n,o,r){return this.logout(),e=this._getHeaders(e),e=this._getAnonymousAuthorizationHeaders(e),this.platform.invokeService({url:t,method:n,headers:e,withCredentials:o,data:r,module:s.MODULE_NAMES.AUTHORIZATION}).then(function(e){return new u(e,null)}).then(this._anonymousTokenResponseConverter.bind(this)).catch(function(e){return this.logger.error("Login failed with error: "+e.statusCode),this._clearState(),Promise.reject(e)}.bind(this)).then(this._authenticateAnonymousSuccess.bind(this))}},{key:"_getHeaders",value:function(e){return e}},{key:"_authenticateAnonymousSuccess",value:function(e){return this.logger.info("User logged in anonymously "+e.statusCode),this._setAuthenticateAnonymousSuccess(e.accessToken),e}},{key:"_setAuthenticateAnonymousSuccess",value:function(e){this._isAnonymous=!0,this._isAuthorized=!0,this._anonymousAccessToken=e;for(var t=0;t<this._onAuthenticationCallbacks.length;t++)this._onAuthenticationCallbacks[t](e)}},{key:"_authenticateError",value:function(e){this.logger.error("Login failed with error: "+e.statusCode),this._clearState()}},{key:"_clearState",value:function(){this._accessToken=null,this._isAnonymous=!1,this._anonymousAccessToken=null,this._isAuthorized=!1}},{key:"onAuthentication",value:function(e){this._onAuthenticationCallbacks.push(e)}},{key:"isAuthorized",get:function(){return this._isAuthorized}}]),e}();n.Authorization=c},{"../logger":13,"../responses/network-response":21,"../types":41}],4:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.BasicAuthorization=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=e("./authorization"),i=e("../logger"),s=e("../responses/network-response"),a=e("./mcs-authorization"),u=e("../types"),c=e("../dictionary");var l=function(e){function t(e,n,o,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,n,o,r));return s._logger=new i.Logger("BasicAuthorization"),s._backendId=o.validateConfiguration(e.mobileBackendId),s._anonymousToken=o.validateConfiguration(e.anonymousKey),s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.MCSAuthorization),o(t,[{key:"getAuthorizedUserName",value:function(){return this._authorizedUserName}},{key:"authenticate",value:function(){var e=arguments.length<=0?void 0:arguments[0],t=arguments.length<=1?void 0:arguments[1];if(this.logout(),!e||!t)return this._logger.error("Wrong username or password parameter"),Promise.reject(new s.NetworkResponse(400,"Bad Request"));var n="Basic "+this.utils.encodeBase64(e+":"+t),o=new c.Dictionary([]);return o.add(u.HEADERS.AUTHORIZATION,n),o.add(u.HEADERS.ORACLE_MOBILE_BACKEND_ID,this._backendId),this.platform.invokeService({url:this.backend.getPlatformUrl("users/login"),method:u.HTTP_METHODS.GET,headers:o,module:u.MODULE_NAMES.AUTHORIZATION}).then(function(t){return this._authenticateSuccess(t,n),this._authorizedUserName=e,t}.bind(this)).catch(function(e){return this._authenticateError(e),Promise.reject(e)}.bind(this))}},{key:"authenticateAnonymous",value:function(){return this._authenticateAnonymousInvoke(new c.Dictionary([]),this.backend.getPlatformUrl("users/login"),u.HTTP_METHODS.GET)}},{key:"_getAnonymousAuthorizationHeaders",value:function(e){return e.add(u.HEADERS.AUTHORIZATION,"Basic "+this._anonymousToken),e.add(u.HEADERS.ORACLE_MOBILE_BACKEND_ID,this._backendId),e}},{key:"isTokenValid",value:function(){return null!==this.getAccessToken()&&"string"==typeof this.getAccessToken()?(this._logger.info("Authorization token is not null or empty"),!0):null==this.getAccessToken()&&"string"!=typeof this.getAccessToken()?(this._logger.info("Authorization token is null and/or empty"),!1):void 0}},{key:"refreshToken",value:function(){return this._getIsAuthorized()||this.isTokenValid()?this._getIsAuthorized()&&this.isTokenValid()?(this._logger.debug("Authenticated token is valid, you do not need to refresh."),Promise.resolve(new s.NetworkResponse(200,this.getAccessToken()))):void 0:Promise.reject(new s.NetworkResponse(401,"Please use the authenticate with username/password combination or authenticateAnonymous function before using refreshToken."))}},{key:"logout",value:function(){this._clearState()}},{key:"_anonymousTokenResponseConverter",value:function(e){return new r.AuthenticationResponse(e,"Basic "+this._anonymousToken)}},{key:"_getHttpHeaders",value:function(e){return null!==this.getAccessToken()&&"string"==typeof this.getAccessToken()&&e.add(u.HEADERS.AUTHORIZATION,this.getAccessToken()),e.add(u.HEADERS.ORACLE_MOBILE_BACKEND_ID,this._backendId),e}},{key:"_getAnonymousHttpHeaders",value:function(e){return this._getAnonymousAccessToken()&&"string"==typeof this._getAnonymousAccessToken()&&e.add(u.HEADERS.AUTHORIZATION,this._getAnonymousAccessToken()),e.add(u.HEADERS.ORACLE_MOBILE_BACKEND_ID,this._backendId),e}},{key:"_clearState",value:function(){(function e(t,n,o){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,n);if(void 0===r){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,o)}if("value"in r)return r.value;var s=r.get;return void 0!==s?s.call(o):void 0})(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_clearState",this).call(this),this._authorizedUserName=null}}]),t}();n.BasicAuthorization=l},{"../dictionary":12,"../logger":13,"../responses/network-response":21,"../types":41,"./authorization":3,"./mcs-authorization":7}],5:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.ExternalTokenExchangeAuthorization=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=e("./authorization"),i=e("../logger"),s=e("../responses/network-response"),a=e("./mcs-authorization"),u=e("../types"),c=e("../dictionary");var l=function(e){function t(e,n,o,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,n,o,r));return s.logger=new i.Logger("ExternalTokenExchangeAuthorization"),s._backendId=o.validateConfiguration(e.mobileBackendId),s._anonymousToken=o.validateConfiguration(e.anonymousKey),s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.MCSAuthorization),o(t,[{key:"authenticate",value:function(){var e=arguments.length<=0?void 0:arguments[0];if(this.logout(),this._redToken=e,!e)return this.logger.error("Wrong token parameter"),Promise.reject(new s.NetworkResponse(400,"Bad Request"));var t="Bearer "+e,n=this.backend.getHttpHeaders();return n.add(u.HEADERS.AUTHORIZATION,t),n.add(u.HEADERS.ORACLE_MOBILE_BACKEND_ID,this._backendId),this.platform.invokeService({url:this.backend.getPlatformUrl("sso/exchange-token?format=json"),method:u.HTTP_METHODS.GET,headers:n,module:u.MODULE_NAMES.AUTHORIZATION}).then(function(e){return this._tokenExpiredTime=Date.now()+1e3*e.data.expires_in,this._authenticateSuccess(e,e.data.access_token),new s.NetworkResponse(200,e.data)}.bind(this)).catch(function(e){return this._authenticateError(e),Promise.reject(e)}.bind(this))}},{key:"authenticateAnonymous",value:function(){return this._authenticateAnonymousInvoke(new c.Dictionary([]),this.backend.getPlatformUrl("users/login"),u.HTTP_METHODS.GET)}},{key:"_getAnonymousAuthorizationHeaders",value:function(e){return e.add(u.HEADERS.AUTHORIZATION,"Basic "+this._anonymousToken),e.add(u.HEADERS.ORACLE_MOBILE_BACKEND_ID,this._backendId),e}},{key:"isTokenValid",value:function(){return!(!this.getAccessToken()&&!this._getAnonymousAccessToken())&&(this.logger.debug("Token is not null or empty"),Date.now()>=this._tokenExpiredTime?(this.logger.info("Token has expired or user has not been authenticate with the service"),!1):(this.logger.debug("Token is still valid"),!0))}},{key:"logout",value:function(){this._redToken=null,this._clearState()}},{key:"refreshToken",value:function(){return!1===this.isTokenValid()?(this.logger.error("Token is not valid and has expired, refreshing token from service.",this._redToken),this.authenticate(this._redToken).then(function(){return this._accessToken})):null==this._accessToken&&this._isAnonymous?(this.logger.error("Anonymous token is valid, you do not need to refresh."),Promise.resolve(this._anonymousAccessToken)):this._anonymousAccessToken||this._isAnonymous?void 0:(this.logger.error("Authenticated token is valid, you do not need to refresh."),Promise.resolve(this._accessToken))}},{key:"_getHttpHeaders",value:function(e){return null!==this.getAccessToken()&&"string"==typeof this.getAccessToken()&&e.add(u.HEADERS.AUTHORIZATION,"Bearer "+this.getAccessToken()),e}},{key:"_getAnonymousHttpHeaders",value:function(e){return this._getAnonymousAccessToken()&&"string"==typeof this._getAnonymousAccessToken()&&e.add(u.HEADERS.AUTHORIZATION,"Bearer "+this._getAnonymousAccessToken()),e}},{key:"_anonymousTokenResponseConverter",value:function(e){return new r.AuthenticationResponse(e,e.data.access_token)}}]),t}();n.ExternalTokenExchangeAuthorization=l},{"../dictionary":12,"../logger":13,"../responses/network-response":21,"../types":41,"./authorization":3,"./mcs-authorization":7}],6:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.FacebookAuthorization=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=e("./authorization"),i=e("../logger"),s=e("../responses/network-response"),a=e("./mcs-authorization"),u=e("../dictionary"),c=e("../types");var l=function(e){function t(e,n,o,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,n,o,r));return s.expiredTime=null,s.logger=new i.Logger("FacebookAuthorization"),s._backendId=o.validateConfiguration(e.mobileBackendId),s._anonymousToken=o.validateConfiguration(e.anonymousKey),s._facebookAppId=o.validateConfiguration(e.appId),s._scopes=o.validateConfiguration(e.scopes),s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.MCSAuthorization),o(t,[{key:"getFacebookAppId",value:function(){return this._facebookAppId}},{key:"authenticate",value:function(){if(this.logout(),"undefined"!=typeof cordova){var e=cordova.require("cordova/plugin_list").metadata;return!0!==this.isInAppBrowserInstalled(e)?Promise.reject(new s.NetworkResponse(100,'Could not find InAppBrowser plugin, use command "cordova plugin add cordova-plugin-inappbrowser"')):this.authenticateInvoke()}return Promise.reject(new s.NetworkResponse(400,"Bad Request - This method require Cordova framework"))}},{key:"authenticateInvoke",value:function(){return new Promise(function(e,t){var n=this,o=this.getFacebookAppId(),r="http://localhost/callback",i="https://www.facebook.com/dialog/oauth?client_id="+o+"&redirect_uri="+r+"&response_type=token&scope="+this._scopes?this.scopes:"public_profile",a=window.open(i,"_blank","location=no,clearsessioncache=yes,clearcache=yes");a.show(),this.logger.info("Opening InAppBrowser to url: "+i),a.addEventListener("loadstart",function(o){if(0===o.url.indexOf(r)){a.close();for(var i=o.url.split("#")[1],u=i.split("&"),c={},l=0;l<u.length;l++)c[u[l].split("=")[0]]=u[l].split("=")[1];c.access_token?(n.expiredTime=Date.now()+1e3*c.expires_in,e(new s.NetworkResponse(200,c))):0===o.url.indexOf("error_code=100")||n.isAuthorized||t(new s.NetworkResponse(100,"Cannot authenticate via a web browser"))}}),a.addEventListener("exit",function(){n._getIsAuthorized()||t(new s.NetworkResponse(100,"Cannot authenticate via a web browser"))})}.bind(this)).then(function(e){return this._authenticateSuccess(e,e.data.access_token),this.expiredTime=Date.now()+1e3*e.data.expires_in,e}.bind(this)).catch(function(e){return this._authenticateError(e),Promise.reject(e)}.bind(this))}},{key:"authenticateAnonymous",value:function(){return this._authenticateAnonymousInvoke(new u.Dictionary([]),this.backend.getPlatformUrl("users/login"),c.HTTP_METHODS.GET)}},{key:"_getAnonymousAuthorizationHeaders",value:function(e){return e.add(c.HEADERS.AUTHORIZATION,"Basic "+this._anonymousToken),e.add(c.HEADERS.ORACLE_MOBILE_BACKEND_ID,this._backendId),e}},{key:"_anonymousTokenResponseConverter",value:function(e){return new r.AuthenticationResponse(e,"Basic "+this._anonymousToken)}},{key:"isTokenValid",value:function(){return!(!this.getAccessToken()&&!this._getAnonymousAccessToken())&&(this.logger.debug("Token is not null or empty"),Date.now()>=this.expiredTime?(this.logger.info("Token has expired or user has not been authenticate with the service/Facebook"),!1):(this.logger.debug("Token is still valid"),!0))}},{key:"refreshToken",value:function(){var e=this.isTokenValid();return e&&null==this.getAccessToken()&&this._getIsAnonymous()?Promise.resolve(new s.NetworkResponse(200,this._getAnonymousAccessToken())):e&&this._getAnonymousAccessToken()&&!this._getIsAnonymous()?Promise.resolve(new s.NetworkResponse(200,this._getAnonymousAccessToken())):(this.logger.error("Token is not valid and has expired, refreshing token from Facebook."),this.authenticate())}},{key:"logout",value:function(){this._clearState(),this.expiredTime=1e3*Date.now()}},{key:"_getHttpHeaders",value:function(e){return null!=this.getAccessToken()&&"string"==typeof this.getAccessToken()&&(e.add(c.HEADERS.AUTHORIZATION,"Basic "+this._anonymousToken),e.add(c.HEADERS.ORACLE_MOBILE_SOCIAL_ACCESS_TOKEN,this.getAccessToken()),e.add(c.HEADERS.ORACLE_MOBILE_SOCIAL_IDENTITY_PROVIDER,"facebook")),e.add(c.HEADERS.ORACLE_MOBILE_BACKEND_ID,this._backendId),e}},{key:"_getAnonymousHttpHeaders",value:function(e){return this._getAnonymousAccessToken()&&"string"==typeof this._getAnonymousAccessToken()&&e.add(c.HEADERS.AUTHORIZATION,this._getAnonymousAccessToken()),e.add(c.HEADERS.ORACLE_MOBILE_BACKEND_ID,this._backendId),e}},{key:"isInAppBrowserInstalled",value:function(e){return["cordova-plugin-inappbrowser","org.apache.cordova.inappbrowser"].some(function(t){return e.hasOwnProperty(t)})}}]),t}();n.FacebookAuthorization=l},{"../dictionary":12,"../logger":13,"../responses/network-response":21,"../types":41,"./authorization":3,"./mcs-authorization":7}],7:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.MCSAuthorization=n.AuthenticationResponse=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=e("../logger"),i=e("./user"),s=e("../responses/network-response"),a=e("./authorization"),u=e("../types");function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function h(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}n.AuthenticationResponse=function(e){function t(e,n){c(this,t);var o=l(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e.statusCode,e.data,e.headers));return o.accessToken=n,o}return h(t,s.NetworkResponse),t}();var f=function(e){function t(e,n,o){c(this,t);var i=l(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,n,o));return i.backend=e,i.utils=n,i.platform=o,i.logger=new r.Logger("MCSAuthorization"),i}return h(t,a.Authorization),o(t,[{key:"getCurrentUser",value:function(){return this.platform.invokeService({method:"GET",url:this.backend.getPlatformUrl("users/~"),headers:this.backend.getHttpHeaders(),module:u.MODULE_NAMES.AUTHORIZATION}).then(function(e){var t=e.data?new i.User(e.data):null;return{statusCode:e.statusCode,user:t}}.bind(this),function(e){return Promise.reject(e)}.bind(this))}},{key:"_authenticateSuccess",value:function(e,t){this.logger.info("User logged in "+e.statusCode),this._isAnonymous=!1,this._isAuthorized=!0,this._accessToken=t;for(var n=0;n<this._onAuthenticationCallbacks.length;n++)this._onAuthenticationCallbacks[n](t)}},{key:"getAuthorizedUserName",value:function(){throw Error("THis method is not supported by this authorization method.")}}]),t}();n.MCSAuthorization=f},{"../logger":13,"../responses/network-response":21,"../types":41,"./authorization":3,"./user":9}],8:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.OAuthAuthorization=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=e("./authorization"),i=e("../logger"),s=e("../responses/network-response"),a=e("./mcs-authorization"),u=e("../types"),c=e("../dictionary");var l=function(e){function t(e,n,o,r,s,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var u=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,o,s,a));return u.oAuthTokenEndPoint=e,u.config=n,u.logger=new i.Logger("OAuthAuthorization"),u._clientId=s.validateConfiguration(n.clientId),u._clientSecret=s.validateConfiguration(n.clientSecret),u._tenantName=s.validateConfiguration(r),u}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.MCSAuthorization),o(t,[{key:"getAuthorizedUserName",value:function(){return this._authorizedUserName}},{key:"getClientId",value:function(){return this._clientId}},{key:"getTenantName",value:function(){return this._tenantName}},{key:"getClientSecret",value:function(){return this._clientSecret}},{key:"authenticate",value:function(){var e=arguments.length<=0?void 0:arguments[0],n=arguments.length<=1?void 0:arguments[1];if(this.logout(),!e||!n)return this.logger.error("Wrong username or password parameter"),Promise.reject(new s.NetworkResponse(400,"Bad Request"));var o="Basic "+this.utils.encodeBase64(this._clientId+":"+this._clientSecret),r=this.config.scope||this.backend._baseUrl+"urn:opc:resource:consumer::all",i=t.urlEncodeComponent(e,n,r),a=new c.Dictionary([]);return a.add(u.HEADERS.CONTENT_TYPE,u.CONTENT_TYPES.X_WWW_FORM_FORM_URLENCODED),a.add(u.HEADERS.AUTHORIZATION,o),void 0!==this._tenantName&&a.add(u.HEADERS.X_RESOURCE_IDENTITY_DOMAIN_NAME,this._tenantName),this.platform.invokeService({url:this.getOAuthTokenUrl(),method:u.HTTP_METHODS.POST,headers:a,data:i,withCredentials:!1,module:u.MODULE_NAMES.AUTHORIZATION}).then(function(t){return this._authenticateSuccess(t,t.data.access_token),this._authorizedUserName=e,t}.bind(this)).catch(function(e){return this._authenticateError(e),Promise.reject(e)}.bind(this))}},{key:"authenticateAnonymous",value:function(){var e=new c.Dictionary([]);e.add(u.HEADERS.CONTENT_TYPE,u.CONTENT_TYPES.X_WWW_FORM_FORM_URLENCODED),void 0!==this._tenantName&&e.add(u.HEADERS.X_USER_IDENTITY_DOMAIN_NAME,this._tenantName);var t=this.config.scope||this.backend._baseUrl+"urn:opc:resource:consumer::all",n="grant_type=client_credentials&scope="+encodeURIComponent(t);return this._authenticateAnonymousInvoke(e,this.getOAuthTokenUrl(),u.HTTP_METHODS.POST,!1,n).then(function(e){return this._tokenExpiredTime=Date.now()+1e3*e.data.expires_in,e}.bind(this))}},{key:"_getAnonymousAuthorizationHeaders",value:function(e){return e.add(u.HEADERS.AUTHORIZATION,"Basic "+this.utils.encodeBase64(this.getClientId()+":"+this.getClientSecret())),e}},{key:"isTokenValid",value:function(){return!(!this.getAccessToken()&&!this._getAnonymousAccessToken())&&(this.logger.debug("Token is not null or empty"),Date.now()>=this._tokenExpiredTime?(this.logger.info("Token has expired"),!1):(this.logger.debug("Token is still valid"),!0))}},{key:"logout",value:function(){this._clearState()}},{key:"refreshToken",value:function(){var e=this.isTokenValid();return e&&!this.getAccessToken()&&this._getIsAnonymous()?Promise.resolve(new s.NetworkResponse(200,this._getAnonymousAccessToken())):!e||this._getAnonymousAccessToken()||this._getIsAnonymous()?(this.logger.error("Token has expired or user has not been authenticate with the service."),Promise.resolve(new s.NetworkResponse(401,"Please use the authenticate with username/password combination or authenticateAnonymous function before using refreshToken."))):Promise.resolve(new s.NetworkResponse(200,this._getAnonymousAccessToken()))}},{key:"_anonymousTokenResponseConverter",value:function(e){return new r.AuthenticationResponse(e,e.data.access_token)}},{key:"_clearState",value:function(){(function e(t,n,o){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,n);if(void 0===r){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,o)}if("value"in r)return r.value;var s=r.get;return void 0!==s?s.call(o):void 0})(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"_clearState",this).call(this),this._authorizedUserName=null,this._tokenExpiredTime=1e3*Date.now()}},{key:"_getHttpHeaders",value:function(e){return null!==this.getAccessToken()&&"string"==typeof this.getAccessToken()&&e.add(u.HEADERS.AUTHORIZATION,"Bearer "+this.getAccessToken()),e}},{key:"_getAnonymousHttpHeaders",value:function(e){return this._getAnonymousAccessToken()&&"string"==typeof this._getAnonymousAccessToken()&&e.add(u.HEADERS.AUTHORIZATION,"Bearer "+this._getAnonymousAccessToken()),e}},{key:"getOAuthTokenUrl",value:function(){var e=this.utils.validateConfiguration(this.oAuthTokenEndPoint);return this.utils.strEndsWith(e,"/")||(e+="/"),e+"oauth2/v1/token"}}],[{key:"urlEncodeComponent",value:function(e,t,n){return"grant_type=password&username="+(e=e.indexOf("@")>-1?encodeURIComponent(e).replace(/%20/g,"+"):encodeURIComponent(e).replace(/%5B/g,"[").replace(/%5D/g,"]"))+"&password="+(t=t.indexOf("&")>-1?encodeURIComponent(t).replace(/%20/g,"+"):encodeURIComponent(t).replace(/%5B/g,"[").replace(/%5D/g,"]"))+"&scope="+(n=encodeURIComponent(n))}}]),t}();n.OAuthAuthorization=l},{"../dictionary":12,"../logger":13,"../responses/network-response":21,"../types":41,"./authorization":3,"./mcs-authorization":7}],9:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();var r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._id=t.id,this._userName=t.username,this._firstName=t._firstName,this._lastName=t._lastName,this._email=t.email}return o(e,[{key:"getId",value:function(){return this._id}},{key:"getFirstName",value:function(){return this._firstName}},{key:"getLastName",value:function(){return this._lastName}},{key:"getEmail",value:function(){return this._email}}]),e}();n.User=r},{}],10:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.CustomCode=void 0;var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),i=e("../responses/network-response"),s=e("../types");var a=function(){function e(t,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.backend=t,this.utils=n,this.platform=o}return r(e,[{key:"checkParameters",value:function(e,t){return this.isJSON(e)&&e&&null!=e&&(void 0===e?"undefined":o(e))==t}},{key:"isJSON",value:function(e){"string"!=typeof e&&(e=JSON.stringify(e));try{return JSON.parse(e),!0}catch(e){return!1}}},{key:"invokeCustomCodeJSONRequest",value:function(t,n,o){if(n in e.httpMethods){if(n===e.httpMethods.DELETE&&o)return Promise.reject(new i.NetworkResponse(500,"DELETE method content body"));var r=this.backend.getHttpHeaders();r.add(s.HEADERS.CONTENT_TYPE,s.CONTENT_TYPES.APPLICATION_JSON);var a=o?JSON.stringify(o):null;return this.platform.invokeService({method:n,url:this.backend.getCustomCodeUrl(t),headers:r,data:a,module:s.MODULE_NAMES.CUSTOM_CODE})}return Promise.reject(new i.NetworkResponse(501,"Method Not Implemented"))}}]),e}();a.httpMethods={GET:"GET",POST:"POST",PUT:"PUT",DELETE:"DELETE"},n.CustomCode=a},{"../responses/network-response":21,"../types":41}],11:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Diagnostics=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=e("../logger"),i=e("../dictionary"),s=e("../types");var a=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.platform=t,this.logger=new r.Logger("Diagnostics"),this._sessionId=n.uuid()}return o(e,[{key:"_getHttpHeaders",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new i.Dictionary([]);return e.add(s.HEADERS.ORACLE_MOBILE_DIAGNOSTIC_SESSION_ID,this.getSessionId()),e.add(s.HEADERS.ORACLE_MOBILE_DEVICE_ID,this.platform.getDeviceId()),e.add(s.HEADERS.ORACLE_MOBILE_CLIENT_REQUEST_TIME,(new Date).toISOString()),e}},{key:"getSessionId",value:function(){return this._sessionId}}]),e}();n.Diagnostics=a},{"../dictionary":12,"../logger":13,"../types":41}],12:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();n.Dictionary=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._keys=[],this._values=[];for(var n=0;n<t.length;n++)this[t[n].key.toString()]=t[n].value,this._keys.push(t[n].key),this._values.push(t[n].value)}return o(e,[{key:"add",value:function(e,t){this[e.toString()]=t,this._keys.push(e),this._values.push(t)}},{key:"remove",value:function(e){var t=this._keys.indexOf(e,0);this._keys.splice(t,1),this._values.splice(t,1),delete this[e.toString()]}},{key:"keys",value:function(){return this._keys}},{key:"values",value:function(){return this._values}},{key:"containsKey",value:function(e){return void 0!==this[e.toString()]}},{key:"toLookup",value:function(){return this}}]),e}()},{}],13:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();var r=n.Logger=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.module=t}return o(e,[{key:"debug",value:function(){for(var t=arguments.length,n=Array(t),o=0;o<t;o++)n[o]=arguments[o];this.log(e.LOG_LEVEL.DEBUG,n)}},{key:"error",value:function(){for(var t=arguments.length,n=Array(t),o=0;o<t;o++)n[o]=arguments[o];this.log(e.LOG_LEVEL.ERROR,n)}},{key:"info",value:function(){for(var t=arguments.length,n=Array(t),o=0;o<t;o++)n[o]=arguments[o];this.log(e.LOG_LEVEL.INFO,n)}},{key:"warn",value:function(){for(var t=arguments.length,n=Array(t),o=0;o<t;o++)n[o]=arguments[o];this.log(e.LOG_LEVEL.WARN,n)}},{key:"log",value:function(t,n){if(e.logLevel>=t){n.unshift("[mcs."+this.module+"]");var o=void 0;switch(e.logLevel){case e.LOG_LEVEL.ERROR:o=console.error;break;case e.LOG_LEVEL.WARN:o=console.warn;break;case e.LOG_LEVEL.INFO:o=console.info;break;case e.LOG_LEVEL.DEBUG:o=console.debug}e.historyEnabled&&(e.history.push(Object.assign({},n,{level:t})),e.historySize<=e.history.length&&e.history.shift()),o.apply(console,n)}}}]),e}();r.LOG_LEVEL={NONE:0,ERROR:1,WARN:2,INFO:3,DEBUG:4},r.logLevel=r.LOG_LEVEL.ERROR,r.historyEnabled=!1,r.historySize=100,r.history=[]},{}],14:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.MCS=void 0;var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),i=e("./utils"),s=e("./logger"),u=e("./analytics/analytics-event"),c=e("./storage/storage-object"),l=e("./mobile-backend/mobile-backend"),h=e("./polices-map"),f=e("./platform/browser-platform"),d=e("./platform/cordova-platform"),p=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}}(e("./types"));var y=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.cxa=t,this._global=n,this._logger=new s.Logger("MCS"),this._utils=new i.Utils,this._getLogHistory=function(){return s.Logger.history},this.mobileBackend=null,this.StorageObject=c.StorageObject,this.LOG_LEVEL=s.Logger.LOG_LEVEL,this.AUTHENTICATION_TYPES=p.AUTHENTICATION_TYPES,this.AnalyticsEvent=u.AnalyticsEvent,this._syncExpress=void 0!==n.mcs?n.mcs.sync:null}return r(e,[{key:"init",value:function(e){this._config=Object.assign({mcsVersion:"18.2.1.0"},e),void 0!==e.logLevel?s.Logger.logLevel=e.logLevel:s.Logger.logLevel=this.LOG_LEVEL.NONE;var t=e;this._logger.debug("MCS initialization, version",t.mcsVersion),void 0!==t.logHistoryEnabled&&(s.Logger.historyEnabled=t.logHistoryEnabled),void 0!==t.logHistorySize&&(s.Logger.historySize=t.logHistorySize),void 0!==t.mcsGlobal&&t.mcsGlobal&&(this._global.mcs=Object.assign({},this._global.mcs,this)),this._syncExpress?this._initPersistenceConfiguration(e):(e.sync||e.syncExpress)&&this._logger.warn("Sync script was not included on page, switch caching off"),this._logger.debug(this._utils.isCordova()?"Create Cordova platform":"Create Browser platform"),this._platform=this._utils.isCordova()?new d.CordovaPlatform(this._config,this._utils,e.logHTTP):new f.BrowserPlatform(this._config,this._utils,e.logHTTP),e.mobileBackend&&(this.mobileBackend=new l.MobileBackend(this._config,this._platform,this._utils,this._syncExpress))}},{key:"_initPersistenceConfiguration",value:function(e){var t=this._syncExpress;t._setLogLevel(e.logLevel);var n=null;if(e.sync&&e.syncExpress)throw Error("Configuration contains two types synchronisation, please choose one of those types, switch caching off");if(e.sync)n=e.sync,t.options.setModule(t.McsRequestHandler());else{if(!e.syncExpress)return this._logger.warn("Missing synchronization configuration, switch caching off"),void t.options.switchOff();n=e.syncExpress;var o=e.syncExpress.handler&&"OracleRestHandler"===e.syncExpress.handler;t.options.setModule(o?t.OracleRestRequestHandler():t.GenericRequestHandler())}t.options.switchOff(!1);var r={default:{conflictResolutionPolicy:"CLIENT_WINS",expirationPolicy:"NEVER_EXPIRE",expireAfter:600,evictionPolicy:"MANUAL_EVICTION",fetchPolicy:"FETCH_FROM_SERVICE_IF_ONLINE",updatePolicy:"QUEUE_IF_OFFLINE",noCache:!1},periodicRefreshInterval:n.backgroundRefreshPolicy||120,policies:[],periodicRefreshPolicy:null},i=n.policies;for(var s in i)if(i.hasOwnProperty(s)){var a=i[s];a?r.policies.push(this._getPersistencePolicy(a)):this._logger.error("The "+a+"policy was not found in accepted policies.")}t.options.setPolicies(r),t.options.dbFirst=!1,t.options.setMaxSyncAttempts(1),t.options.setAutoRemoveAfterReachMaxAttempts(!0)}},{key:"_getPersistencePolicy",value:function(e){var t={path:e.path};for(var n in e)if(e.hasOwnProperty(n)&&"path"!==n){var o=h.POLICIES_MAP[n];o?void 0===o[e[n]]?this._logger.error("The "+n+" policy value "+e[n]+" was not found in accepted policy values."):t[o.persistencePropertyName]=o[e[n]]:this._logger.error("The "+n+" policy was not found in accepted policies.")}return t}}]),e}();void 0!==a&&(a=function(e,t,n,r,i,s,a,u){var c=void 0,l=new y(u,c=void 0!==r?r:void 0!==i?i:void 0!==s?s:a);"object"===(void 0===t?"undefined":o(t))&&void 0!==e?e.exports=l:"function"==typeof n&&n.amd?n([],l):c.mcs=l}),n.MCS=y},{"./analytics/analytics-event":1,"./logger":13,"./mobile-backend/mobile-backend":15,"./platform/browser-platform":17,"./platform/cordova-platform":18,"./polices-map":20,"./storage/storage-object":24,"./types":41,"./utils":42}],15:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.MobileBackend=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=e("../logger"),i=e("../diagnostics/diagnostics"),s=e("../custom-code/custom-code"),a=e("../analytics/analytics"),u=e("../notifications/notifications"),c=e("../authorization/basic-authorization"),l=e("../authorization/oauth-authorization"),h=e("../authorization/facebook-authorization"),f=e("../authorization/external-token-exchange-authorization"),d=e("../sync/synchronization"),p=e("../storage/storage"),y=e("../types"),g=e("../dictionary");var v=function(){function e(t,n,o,c){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=t,this.platform=n,this.utils=o,this.syncExpress=c,this.PLATFORM_PATH="mobile/platform",this.CUSTOM_CODE_PATH="mobile/custom",this.authenticationType=null,this.logger=new r.Logger("MobileBackend"),this.name=null,this.authorization=null,this.diagnostics=null,this.customCode=null,this.analytics=null,this.storage=null,this.synchronization=null,this.appConfig={},this.notifications=null,this._mbeConfig=t.mobileBackend,this.name=this._mbeConfig.name,this.diagnostics=new i.Diagnostics(n,o),this.customCode=new s.CustomCode(this,o,n),this.analytics=new a.Analytics(this,n,o),this.storage=new p.Storage(this,o,n),this._baseUrl=o.validateConfiguration(this._mbeConfig.baseUrl),c&&(this.synchronization=new d.Synchronization(this,t.sync,o,n,c.common,c.options,c.process)),"undefined"!=typeof cordova&&(this.notifications=new u.Notifications(this,n,navigator)),this._mbeConfig.authentication.type&&this.setAuthenticationType(this._mbeConfig.authentication.type)}return o(e,[{key:"getPlatformUrl",value:function(e){var t=this._baseUrl;return"ssoAuth"==this.authenticationType&&this.utils.strEndsWith(this._baseUrl,"1")&&(t=t.substring(0,t.length-4)+"7777"),t=this.utils.validateConfiguration(t)+"/"+this.PLATFORM_PATH,this.utils.strEndsWith(t,"/")||(t+="/"),t+e}},{key:"getCustomCodeUrl",value:function(e){return this.utils.validateConfiguration(this._baseUrl)+this._getCustomCodeUri(e)}},{key:"getHttpHeaders",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new g.Dictionary([]),t=this.authorization;return e=this.diagnostics._getHttpHeaders(e),t&&(e=t._getIsAuthorized()&&t._getIsAnonymous()?t._getAnonymousHttpHeaders(e):t._getHttpHeaders(e)),e}},{key:"getAuthenticationType",value:function(){return this.authenticationType}},{key:"setAuthenticationType",value:function(e){var t=this.utils.validateConfiguration(e);if(this.authorization=null,!y.AUTHENTICATION_TYPES.hasOwnProperty(t))throw Error("Wrong Authentication type: "+e+", please use one of: \n"+y.AUTHENTICATION_TYPES.basic+"\n"+y.AUTHENTICATION_TYPES.oauth+"\n"+y.AUTHENTICATION_TYPES.facebook+"\n"+y.AUTHENTICATION_TYPES.token);if(!this._mbeConfig.authentication.hasOwnProperty(t))throw Error("No Authentication Type called "+e+" is defined in configuration \ncheck configuration in authorization object for the following objects:\n"+y.AUTHENTICATION_TYPES.basic+"\n"+y.AUTHENTICATION_TYPES.oauth+"\n"+y.AUTHENTICATION_TYPES.facebook+"\n"+y.AUTHENTICATION_TYPES.token);return this.authorization&&this.authorization._getIsAuthorized()&&this.authorization.logout(),t===y.AUTHENTICATION_TYPES.basic?(this.authorization=new c.BasicAuthorization(this._mbeConfig.authentication.basic,this,this.utils,this.platform),this.logger.info("Your Authentication type: "+t),this.authenticationType=t):t===y.AUTHENTICATION_TYPES.oauth?(this.authorization=new l.OAuthAuthorization(this.config.oAuthTokenEndPoint,this._mbeConfig.authentication.oauth,this,this._mbeConfig.tenantId,this.utils,this.platform),this.logger.info("Your Authentication type: "+t),this.authenticationType=t):t===y.AUTHENTICATION_TYPES.facebook?(this.authorization=new h.FacebookAuthorization(this._mbeConfig.authentication.facebook,this,this.utils,this.platform),this.logger.info("Your Authentication type: "+t),this.authenticationType=t):t===y.AUTHENTICATION_TYPES.token&&(this.authorization=new f.ExternalTokenExchangeAuthorization(this._mbeConfig.authentication.token,this,this.utils,this.platform),this.logger.info("Your Authentication type: "+t),this.authenticationType=t),this.authorization}},{key:"loadAppConfig",value:function(){var e=this.getHttpHeaders();return e.add(y.HEADERS.CONTENT_TYPE,y.CONTENT_TYPES.APPLICATION_JSON),this.authorization._getIsAuthorized()||(e=this.authorization._getAnonymousAuthorizationHeaders(e)),this.platform.invokeService({method:y.HTTP_METHODS.GET,url:this.getPlatformUrl("appconfig/client"),headers:e,module:y.MODULE_NAMES.APP_CONFIG}).catch(function(e){return this.logger.error("App config download failed! with status code: "+e.statusCode),Promise.reject(e)}.bind(this))}},{key:"_getCustomCodeUri",value:function(e){var t="/"+this.CUSTOM_CODE_PATH;return this.utils.strEndsWith(e,"/")&&(e=e.slice(0,-1)),t+"/"+e}}]),e}();n.MobileBackend=v},{"../analytics/analytics":2,"../authorization/basic-authorization":4,"../authorization/external-token-exchange-authorization":5,"../authorization/facebook-authorization":6,"../authorization/oauth-authorization":8,"../custom-code/custom-code":10,"../diagnostics/diagnostics":11,"../dictionary":12,"../logger":13,"../notifications/notifications":16,"../storage/storage":25,"../sync/synchronization":40,"../types":41}],16:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Notifications=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=e("../logger"),i=e("../types");var s=function(){function e(t,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.backend=t,this.platform=n,this.navigator=o,this.logger=new r.Logger("Notifications")}return o(e,[{key:"getDevicePlatform",value:function(){var e=void 0;return this.navigator.userAgent.match(/Android/i)?e=i.PLATFORM_ID.ANDROID:(this.navigator.userAgent.match(/iPad/i)||this.navigator.userAgent.match(/iPod/i)||this.navigator.userAgent.match(/iPhone/i))&&(e=i.PLATFORM_ID.IOS),e.toUpperCase()}},{key:"registerForNotifications",value:function(e,t,n,o){if(!(o in i.NOTIFICATION_PROVIDER))throw Error("No Notification Provider Type called "+o+"\nplease use one of those types\n"+i.NOTIFICATION_PROVIDER.APNS+"\n"+i.NOTIFICATION_PROVIDER.FCM+"\n"+i.NOTIFICATION_PROVIDER.WNS+"\n"+i.NOTIFICATION_PROVIDER.SYNIVERSE);var r=this.backend.getHttpHeaders();r.add(i.HEADERS.CONTENT_TYPE,i.CONTENT_TYPES.APPLICATION_JSON);var s={notificationToken:e,notificationProvider:o,mobileClient:{id:t,version:n,platform:"undefined"==typeof device?this.getDevicePlatform():device.platform.toUpperCase()}};return this.platform.invokeService({method:i.HTTP_METHODS.POST,url:this.backend.getPlatformUrl("devices/register"),headers:r,data:JSON.stringify(s),module:i.MODULE_NAMES.NOTIFICATIONS}).then(function(e){return this.logger.info("Device registered for push notifications.",e.statusCode),e}.bind(this)).catch(function(e){return this.logger.error("Device registration for push notifications failed!",e),Promise.reject(e)}.bind(this))}},{key:"deregisterForNotifications",value:function(e,t){var n=this.backend.getHttpHeaders();n.add(i.HEADERS.CONTENT_TYPE,i.CONTENT_TYPES.APPLICATION_JSON);var o={notificationToken:e,mobileClient:{id:t,platform:"undefined"==typeof device?this.getDevicePlatform():device.platform.toUpperCase()}};return this.platform.invokeService({method:i.HTTP_METHODS.POST,url:this.backend.getPlatformUrl("devices/deregister"),headers:n,data:JSON.stringify(o),module:i.MODULE_NAMES.NOTIFICATIONS}).then(function(e){return this.logger.info("Device deregistered for push notifications succeeded.",e.statusCode),e}.bind(this)).catch(function(e){return this.logger.error("Device deregistration for push notifications failed!",e),Promise.reject(e)}.bind(this))}}]),e}();n.Notifications=s},{"../logger":13,"../types":41}],17:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.BrowserPlatform=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=e("./platform"),i=e("../logger"),s=e("../responses/network-response"),a=e("../types");var u=function(e){function t(e,n){var o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,n));return r.config=e,r.logHTTP=o,r.queryRegex=/\?/,r.logger=new i.Logger("BrowserPlatform"),r.isBrowser=!0,r.isCordova=!1,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.Platform),o(t,[{key:"invokeService",value:function(e){var t=e.url;return this.isBrowser&&(t=t+(this.queryRegex.test(t)?"&":"?")+"_="+(new Date).getTime()),new Promise(function(n,o){var r=this,i=new XMLHttpRequest;for(var u in i.open(e.method,t),e.headers)e.headers.hasOwnProperty(u)&&i.setRequestHeader(u,e.headers[u]);if(i.setRequestHeader(a.HEADERS.ORACLE_MOBILE_CLIENT_SDK_INFO,this._getClientSDKInfoHeader(e.module)),i.withCredentials=!e.hasOwnProperty("withCredentials")||"boolean"!=typeof e.withCredentials||e.withCredentials,i.responseType=e.responseType||a.XML_HTTP_REQUEST_RESPONSE_TYPE.JSON,i.onreadystatechange=function(){if(4===i.readyState){var t=""==i.responseType||"text"==i.responseType?i.responseText:i.response,a=i.responseHeaders?r.utils.normalizeHeaderKeys(i.responseHeaders):r.utils.parseHeaders(i.getAllResponseHeaders()),u=new s.NetworkResponse(i.status,t,a);if(r.logHTTP){var c={headers:a,body:t};r.logger.debug("Received "+e.method+" response from "+e.url,c)}i.status>=200&&i.status<=299?n(u):o(u)}},i.send(e.data),this.logHTTP){var c={headers:e.headers,body:e.data};this.logger.debug("Sent "+e.method+" request to "+e.url,c)}}.bind(this))}},{key:"_getClientSDKInfoHeader",value:function(e){var t=this.isCordova?a.PLATFORM_NAMES.CORDOVA:a.PLATFORM_NAMES.JAVASCRIPT;return t+=" "+(this.config.mcsVersion||"Unknown"),t+=" ["+e+"]"}}]),t}();n.BrowserPlatform=u},{"../logger":13,"../responses/network-response":21,"../types":41,"./platform":19}],18:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.CordovaPlatform=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=e("./browser-platform"),i=e("../logger");var s=function(e){function t(e,n){var o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,o));r.ANDROID_OS_NAME="Android",r.IOS_OS_NAME="iOS",r.latitude=null,r.longitude=null,r.logger=new i.Logger("CordovaPlatform"),r.isBrowser=!1,r.isCordova=!0;var s=r;return navigator&&navigator.geolocation&&navigator.geolocation.watchPosition&&navigator.geolocation.watchPosition(function(e){s.latitude=e.coords.latitude+"",s.longitude=e.coords.longitude+""}),r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.BrowserPlatform),o(t,[{key:"getGPSLocation",value:function(){return{latitude:this.latitude,longitude:this.longitude}}},{key:"checkConnection",value:function(){var e=navigator.connection.type,t={};return t[Connection.UNKNOWN]="Unknown connection",t[Connection.ETHERNET]="Ethernet connection",t[Connection.WIFI]="WiFi connection",t[Connection.CELL_2G]="Cell 2G connection",t[Connection.CELL_3G]="Cell 3G connection",t[Connection.CELL_4G]="Cell 4G connection",t[Connection.CELL]="Cell generic connection",t[Connection.NONE]="No network connection",this.logger.info("Connection type: "+t[e]),t[e]}},{key:"getDeviceInformation",value:function(){return"undefined"==typeof device?{model:"<unknown>",manufacturer:"<unknown>",osName:"<unknown>",osVersion:"<unknown>",osBuild:"<unknown>",carrier:"<unknown>"}:{model:device.model,manufacturer:device.manufacturer,osName:device.platform,osVersion:device.version,osBuild:"cordova "+device.cordova,carrier:"<unknown>"}}}]),t}();n.CordovaPlatform=s},{"../logger":13,"./browser-platform":17}],19:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Platform=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=e("../logger");var i=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.utils=t,this.deviceState="undefined"!=typeof deviceState?deviceState.unrestricted:null,this.deviceStateChangedCallbacks=[],this.ANDROID_OS_NAME="",this.IOS_OS_NAME="",this.logger=new r.Logger("Platform"),this.deviceId=t.uuid()}return o(e,[{key:"getDeviceId",value:function(){return this.deviceId}},{key:"setDeviceState",value:function(e){if(this.deviceState!=e){this.logger.info("Device state changing from "+this.deviceState+" to "+e),this.deviceState=e;for(var t=0;t<this.deviceStateChangedCallbacks.length;t++)this.deviceStateChangedCallbacks[t](this.deviceState)}}},{key:"getGPSLocation",value:function(){return{latitude:null,longitude:null}}},{key:"getDeviceInformation",value:function(){return{model:"<unknown>",manufacturer:"<unknown>",osName:"<unknown>",osVersion:"<unknown>",osBuild:"<unknown>",carrier:"<unknown>"}}}]),e}();n.Platform=i},{"../logger":13}],20:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.POLICIES_MAP={fetchPolicy:{persistencePropertyName:"fetchPolicy",FETCH_FROM_CACHE_SCHEDULE_REFRESH:"FETCH_FROM_CACHE_SCHEDULE_REFRESH",FETCH_FROM_SERVICE_IF_ONLINE:"FETCH_FROM_SERVICE_IF_ONLINE",FETCH_FROM_CACHE:"FETCH_FROM_CACHE",FETCH_FROM_SERVICE:"FETCH_FROM_SERVICE",FETCH_FROM_SERVICE_ON_CACHE_MISS:"FETCH_FROM_SERVICE_ON_CACHE_MISS",FETCH_FROM_SERVICE_ON_CACHE_MISS_OR_EXPIRY:"FETCH_FROM_SERVICE_ON_CACHE_MISS_OR_EXPIRY",FETCH_WITH_REFRESH:"FETCH_WITH_REFRESH"},evictionPolicy:{persistencePropertyName:"evictionPolicy",EVICT_ON_EXPIRY_AT_STARTUP:"EVICT_ON_EXPIRY_AT_STARTUP",MANUAL_EVICTION:"MANUAL_EVICTION"},expirationPolicy:{persistencePropertyName:"expirationPolicy",EXPIRE_ON_RESTART:"EXPIRE_ON_RESTART",EXPIRE_AFTER:"EXPIRE_AFTER",NEVER_EXPIRE:"NEVER_EXPIRE"},updatePolicy:{persistencePropertyName:"updatePolicy",QUEUE_IF_OFFLINE:"QUEUE_IF_OFFLINE",UPDATE_IF_ONLINE:"UPDATE_IF_ONLINE"},refreshPolicy:{persistencePropertyName:"refreshPolicy",PeriodicallyRefreshExpiredResource:""},conflictResolutionPolicy:{persistencePropertyName:"conflictResolutionPolicy",SERVER_WINS:"SERVER_WINS",PRESERVE_CONFLICT:"PRESERVE_CONFLICT",CLIENT_WINS:"CLIENT_WINS"},noCache:{persistencePropertyName:"noCache",false:!1,true:!0}}},{}],21:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.NetworkResponse=function e(t,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.statusCode=0,this.data=null,this.statusCode=t,this.data=n,this.headers=o}},{}],22:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.NetworkStorageObject=function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.statusCode=0,this.storageObject=null,this.statusCode=t,this.storageObject=n}},{}],23:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.StorageCollection=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=e("./storage-object"),i=e("../responses/network-storage-object"),s=e("../types");var a=function(){function e(t,n,o,r,i,s,a){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.userIsolated=o,this.backend=r,this.utils=i,this.logger=s,this.platform=a,this.storage=r.storage,this.userId=i.validateConfiguration(n),this.id=i.validateConfiguration(t)}return o(e,[{key:"getStorage",value:function(){return this.storage}},{key:"getUserIsolated",value:function(){return this.data?this.data.userIsolated:this.userIsolated}},{key:"getUserId",value:function(){return this.userId}},{key:"getData",value:function(){return this.data}},{key:"getDescription",value:function(){if(this.data)return this.data.description;this.logger.warn("Collection metadata was not loaded yet, please use StorageCollection.loadMetadata to load metadata.")}},{key:"toJSON",value:function(){return{id:this.id,description:this.getDescription(),userId:this.getUserId(),userIsolated:this.getUserIsolated(),data:this.getData()}}},{key:"loadMetadata",value:function(){var e=this.backend.getHttpHeaders();return e.add(s.HEADERS.ACCEPT,s.CONTENT_TYPES.APPLICATION_JSON),this.platform.invokeService({method:s.HTTP_METHODS.GET,url:this.backend.getPlatformUrl("storage/collections/"+this.id),headers:e,module:s.MODULE_NAMES.STORAGE}).then(function(e){return this.data=e.data,this}.bind(this))}},{key:"getObjects",value:function(e,t,n){var o=this.backend.getHttpHeaders();o.add(s.HEADERS.ACCEPT,s.CONTENT_TYPES.APPLICATION_JSON);var i="storage/collections/"+this.id+"/objects";return null!=e&&(i+=-1==i.indexOf("?")?"?":"&",i+="offset="+e),null!=t&&(i+=-1==i.indexOf("?")?"?":"&",i+="limit="+t),this.getUserIsolated()&&n?(i+=-1==i.indexOf("?")?"?":"&",i+="user=*"):this.getUserIsolated()&&null!=this.getUserId()&&(i+=-1==i.indexOf("?")?"?":"&",i+="user="+this.getUserId()),this.platform.invokeService({method:s.HTTP_METHODS.GET,url:this.backend.getPlatformUrl(i),headers:o,module:s.MODULE_NAMES.STORAGE}).then(function(e){for(var t=[],n=e.data,o=0;o<n.items.length;o++)t[t.length]=new r.StorageObject(this,n.items[o]);return t}.bind(this))}},{key:"getObject",value:function(e,t){var n=new r.StorageObject(this,this.backend);return n.id=e,n.readPayload(t).then(function(){return n})}},{key:"loadObjectPayload",value:function(e,t){var n=this.backend.getHttpHeaders(),o="storage/collections/"+this.id+"/objects/"+e;return null!=this.userId&&this.getUserIsolated()&&(o+="?user="+this.userId),this.platform.invokeService({method:s.HTTP_METHODS.GET,url:this.backend.getPlatformUrl(o),headers:n,responseType:t||s.XML_HTTP_REQUEST_RESPONSE_TYPE.BLOB,module:s.MODULE_NAMES.STORAGE})}},{key:"postObject",value:function(e){return this._postOrPutStorageObject(e,!0)}},{key:"putObject",value:function(e){return this._postOrPutStorageObject(e,!1)}},{key:"_postOrPutStorageObject",value:function(e,t){var n=this.backend.getHttpHeaders();n.add(s.HEADERS.ORACLE_MOBILE_NAME,encodeURI(e.getDisplayName())),n.add(s.HEADERS.CONTENT_TYPE,e.contentType);var o="storage/collections/"+this.id+"/objects";return t||(o+="/"+e.id,null!=e._eTag&&n.add(s.HEADERS.IF_MATCH,e._eTag)),this.getUserIsolated()&&null!=this.getUserId()&&(o+="?user="+this.getUserId()),this.platform.invokeService({method:t?s.HTTP_METHODS.POST:s.HTTP_METHODS.PUT,url:this.backend.getPlatformUrl(o),headers:n,data:e.getPayload(),module:s.MODULE_NAMES.STORAGE}).then(function(e){var t=new r.StorageObject(this,e.data);return new i.NetworkStorageObject(e.statusCode,t)}.bind(this))}},{key:"contains",value:function(e){var t=this.backend.getHttpHeaders(),n="storage/collections/"+this.id+"/objects/"+e;return this.getUserIsolated()&&null!=this.getUserId()&&(n+="?user="+this.getUserId()),this.platform.invokeService({method:s.HTTP_METHODS.HEAD,url:this.backend.getPlatformUrl(n),headers:t,module:s.MODULE_NAMES.STORAGE})}},{key:"deleteObject",value:function(e){var t=this.backend.getHttpHeaders();t.add(s.HEADERS.IF_MATCH,"*");var n="storage/collections/"+this.id+"/objects/"+e;return this.getUserIsolated()&&null!=this.getUserId()&&(n+="?user="+this.getUserId()),this.platform.invokeService({method:s.HTTP_METHODS.DELETE,url:this.backend.getPlatformUrl(n),headers:t,module:s.MODULE_NAMES.STORAGE})}},{key:"description",get:function(){return this.data?this.data.description:void 0}}]),e}();n.StorageCollection=a},{"../responses/network-storage-object":22,"../types":41,"./storage-object":24}],24:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.StorageObject=void 0;var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),i=e("../types");var s=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.storageCollection=t,n&&(this.id=n.id,this.name=n.name,this.contentLength=n.contentLength,this.contentType=n.contentType,this._eTag=n.eTag,this.createdBy=n.createdBy,this.createdOn=n.createdOn,this.modifiedBy=n.modifiedBy,this.modifiedOn=n.modifiedOn)}return r(e,[{key:"getPayload",value:function(){return this.payload}},{key:"setPayload",value:function(e){this.payload=e}},{key:"getstorageCollection",value:function(){return this.storageCollection}},{key:"getStorage",value:function(){return this.storageCollection.getStorage()}},{key:"loadPayload",value:function(e,t){this.payload=e,this.contentType=t,this.contentType===i.CONTENT_TYPES.TEXT_PLAIN?"string"==typeof this.payload&&(this.payload=e):this.contentType===i.CONTENT_TYPES.APPLICATION_JSON&&("string"==typeof this.payload?this.payload=e:"object"==o(this.payload)&&(this.payload=JSON.stringify(e))),this.contentLength=this.payload.length}},{key:"setDisplayName",value:function(e){this.name=e}},{key:"getDisplayName",value:function(){return this.name}},{key:"readPayload",value:function(e){return this.getPayload()?Promise.resolve(this):this.storageCollection.loadObjectPayload(this.id,e).then(function(e){return this.setPayload(e.data),this.name=decodeURI(e.headers[i.HEADERS.ORACLE_MOBILE_NAME.toLowerCase()]),this._eTag=e.headers[i.HEADERS.E_TAG.toLowerCase()],this.contentLength=e.data.size,this.contentType=e.headers[i.HEADERS.CONTENT_TYPE.toLowerCase()],this.createdBy=e.headers[i.HEADERS.ORACLE_MOBILE_CREATED_BY.toLowerCase()],this.createdOn=e.headers[i.HEADERS.ORACLE_MOBILE_CREATED_ON.toLowerCase()],this.modifiedBy=e.headers[i.HEADERS.ORACLE_MOBILE_MODIFIED_BY.toLowerCase()],this.modifiedOn=e.headers[i.HEADERS.ORACLE_MOBILE_MODIFIED_ON.toLowerCase()],this}.bind(this))}}]),e}();n.StorageObject=s},{"../types":41}],25:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Storage=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=e("../logger"),i=e("./storage-collection");var s=function(){function e(t,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.backend=t,this.utils=n,this.platform=o,this.logger=new r.Logger("Storage")}return o(e,[{key:"getCollection",value:function(e,t,n,o){var r=new i.StorageCollection(e,this.utils.validateConfiguration(t),n,this.backend,this.utils,this.logger,this.platform);return o?Promise.resolve(r):r.loadMetadata()}}]),e}();n.Storage=s},{"../logger":13,"./storage-collection":23}],26:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.FetchCollectionBuilder=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=e("../../dictionary");var i=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.endpoint=t,this.json=n,this._fetchFromService=!1,this._offset=-1,this._limit=-1,this._fetchAll=!1,this._withParams={},this._withHeaders=new r.Dictionary([])}return o(e,[{key:"execute",value:function(){return this.endpoint._executeFetchObjects(this._withHeaders,this._withParams,this._fetchAll,this._offset,this._limit,this._fetchFromService)}}]),e}();n.FetchCollectionBuilder=i},{"../../dictionary":12}],27:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.MobileEndpoint=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=e("./mobile-object"),i=e("../processors/get-processor"),s=e("../processors/post-processor"),a=e("../processors/put-processor"),u=e("../processors/delete-processor"),c=e("./mobile-object-collection"),l=e("./fetch-collection-builder"),h=e("../../responses/network-response"),f=e("../../types"),d=e("../../dictionary");var p=function(){function e(t,n,o,r,i,s,a,u){var c=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.backend=r,this.utils=i,this.platform=s,this.common=a,this.options=u,this.purge=function(){c.options.module.flush(c.backend.getCustomCodeUrl(c.apiName+"/"+c.endpointPath))},this.synchronization=t,this.apiName=n,this.endpointPath=o}return o(e,[{key:"createObject",value:function(e){return(e=e||{}).__proto__=new r.MobileObject(this,null),e}},{key:"fetchObject",value:function(e,t){var n=this.apiName;this.endpointPath&&this.endpointPath.length>0&&(n+="/"+this.endpointPath),e&&""!=e&&(n+="/"+e),n=this.backend.getCustomCodeUrl(n);var o=new i.GetProcessor(this.backend,this.apiName,this.endpointPath,this.platform,this.utils,this.common,this.options),s=new d.Dictionary([]);return s.add(f.HEADERS.ACCEPT,f.CONTENT_TYPES.APPLICATION_JSON),o.performRequest(n,s,t).then(function(e){{if(e.data&&""!==e.data){var t=e.data;return"string"==typeof t&&(t=""!=t?JSON.parse(t):null),t.__proto__=new r.MobileObject(this,e.uri),t}return Promise.reject(new h.NetworkResponse(404,"Object not found in cache."))}}.bind(this))}},{key:"_save",value:function(e,t){var n=!e._getMcsURI(),o=n?this.backend.getCustomCodeUrl(this.apiName+"/"+this.endpointPath):this.backend._baseUrl+e._getMcsURI(),i=n?new s.PostProcessor(this.backend,this.apiName,this.endpointPath,this.platform,this.utils,this.common,this.options):new a.PutProcessor(this.backend,this.apiName,this.endpointPath,this.platform,this.utils,this.common,this.options),u=JSON.stringify(e),c=new d.Dictionary([]);return c.add(f.HEADERS.ACCEPT,f.CONTENT_TYPES.APPLICATION_JSON),c.add(f.HEADERS.CONTENT_TYPE,f.CONTENT_TYPES.APPLICATION_JSON),i.performRequest(o,c,u).then(function(t){var n=t.data;"string"==typeof n&&(n=""!=n?JSON.parse(n):null);return this._updateMobileObject(e,n),e.__proto__=new r.MobileObject(this,t.uri),e}.bind(this))}},{key:"_delete",value:function(e,t){var n=new u.DeleteProcessor(this.backend,this.apiName,this.endpointPath,this.platform,this.utils,this.common,this.options),o=this.backend._baseUrl+e._getMcsURI();return n.performRequest(o).then(function(){this._updateMobileObject(e._syncResource),e._syncResource=null}.bind(this))}},{key:"_updateMobileObject",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};for(var n in e)e.hasOwnProperty(n)&&delete e[n];for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])}},{key:"_executeFetchObjects",value:function(e,t,n,o,i,s){var a=this,u=this.backend.getHttpHeaders(e);u.add(f.HEADERS.ORACLE_MOBILE_SYNC_AGENT,"true");var l={method:f.HTTP_METHODS.GET,url:this.backend.getCustomCodeUrl(this.apiName+"/"+this.endpointPath),headers:u,module:f.MODULE_NAMES.SYNC};return this.platform.invokeService(l).then(function(e){var t=e.data;"string"==typeof t&&(t=""!=t?JSON.parse(t):null);var n=[];for(var o in t.items)if(t.items.hasOwnProperty(o)){var i=t.items[o],s="/"+t.uris[o];i.__proto__=new r.MobileObject(a,s),n.push(i)}return new c.MobileObjectCollection(a,null).initialize(n)}.bind(this))}},{key:"fetchObjects",value:function(){return new l.FetchCollectionBuilder(this)}}]),e}();n.MobileEndpoint=p},{"../../dictionary":12,"../../responses/network-response":21,"../../types":41,"../processors/delete-processor":31,"../processors/get-processor":32,"../processors/post-processor":33,"../processors/put-processor":34,"./fetch-collection-builder":26,"./mobile-object":29,"./mobile-object-collection":28}],28:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.MobileObjectCollection=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=e("./mobile-resource"),i=e("../sync-resource-type");var s=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return o._type=i.SyncResourceType.item,o._objects=[],o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.MobileResource),o(t,[{key:"initialize",value:function(e){for(var t in e)if(e.hasOwnProperty(t)){var n=e[t];this._objects.push(n)}return this}},{key:"getLength",value:function(){return this._objects.length}},{key:"getItem",value:function(e){return this._objects[e]}},{key:"all",value:function(){return this._objects}},{key:"forEach",value:function(e){this._objects.forEach(e)}}]),t}();n.MobileObjectCollection=s},{"../sync-resource-type":39,"./mobile-resource":30}],29:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.MobileObject=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=e("./mobile-resource"),i=e("../sync-resource-type");var s=function(e){function t(e,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return o._type=i.SyncResourceType.item,o}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.MobileResource),o(t,[{key:"save",value:function(e){return this._getEndpoint()._save(this,e)}},{key:"delete",value:function(e){return this._getEndpoint()._delete(this,e)}}]),t}();n.MobileObject=s},{"../sync-resource-type":39,"./mobile-resource":30}],30:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();var r=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.endpoint=t,this.uri=n}return o(e,[{key:"_getEndpoint",value:function(){return this.endpoint}},{key:"_getMcsId",value:function(){return this.uri?this.uri.substring(this.uri.lastIndexOf("/")+1,this.uri.length):null}},{key:"_getMcsURI",value:function(){return this.uri}}]),e}();n.MobileResource=r},{}],31:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.DeleteProcessor=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=e("./sync-processor"),i=e("../../types"),s=e("../../dictionary");var a=function(e){function t(e,n,o,r,i,s,a){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,o,!1,i,r,a,s))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.SyncProcessor),o(t,[{key:"performRequest",value:function(e){var t=this.getHttpHeaders(new s.Dictionary([]));return this.platform.invokeService({method:i.HTTP_METHODS.DELETE,url:e,module:i.MODULE_NAMES.SYNC,headers:t})}}]),t}();n.DeleteProcessor=a},{"../../dictionary":12,"../../types":41,"./sync-processor":35}],32:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.GetProcessor=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=e("./sync-processor"),i=e("../../types");var s=function(e){function t(e,n,o,r,i,s,a){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,o,!1,i,r,a,s))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.SyncProcessor),o(t,[{key:"performRequest",value:function(e,t,n){var o=this.getHttpHeaders(t);return this.platform.invokeService({method:i.HTTP_METHODS.GET,url:e,headers:o,module:i.MODULE_NAMES.SYNC}).then(function(t){return{uri:this.getUri(t,e),data:t.data}}.bind(this))}}]),t}();n.GetProcessor=s},{"../../types":41,"./sync-processor":35}],33:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.PostProcessor=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=e("./sync-processor"),i=e("../../types");n.PostProcessor=function(e){function t(e,n,o,r,i,s,a){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,o,!1,i,r,a,s))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.SyncProcessor),o(t,[{key:"performRequest",value:function(e,t,n){var o=this.getHttpHeaders(t);return this.platform.invokeService({method:i.HTTP_METHODS.POST,url:e,headers:o,data:n,module:i.MODULE_NAMES.SYNC}).then(function(t){return{uri:this.getUri(t,e),data:t.data}}.bind(this))}}]),t}()},{"../../types":41,"./sync-processor":35}],34:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.PutProcessor=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=e("./sync-processor"),i=e("../../types");n.PutProcessor=function(e){function t(e,n,o,r,i,s,a){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,o,!1,i,r,a,s))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.SyncProcessor),o(t,[{key:"performRequest",value:function(e,t,n){var o=this.getHttpHeaders(t);return this.platform.invokeService({method:i.HTTP_METHODS.PUT,url:e,headers:o,data:n,module:i.MODULE_NAMES.SYNC}).then(function(t){return{uri:this.getUri(t,e),data:t.data}}.bind(this))}}]),t}()},{"../../types":41,"./sync-processor":35}],35:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.SyncProcessor=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=e("../sync-resource-type"),i=e("../sync-express/mcs-request-handler"),s=e("../../types");n.SyncProcessor=function(){function e(t,n,o,r,i,s,a,u){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.backend=t,this.apiName=n,this.endpointPath=o,this.resolvingOfflineUpdate=r,this.utils=i,this.platform=s,this.options=a,this.common=u}return o(e,[{key:"getHttpHeaders",value:function(e){var t=this.backend.getHttpHeaders(e);return t.add(s.HEADERS.ORACLE_MOBILE_SYNC_AGENT,"true"),t}},{key:"getType",value:function(e,t){var n=r.SyncResourceType.file,o=e[s.HEADERS.ORACLE_MOBILE_SYNC_RESOURCE_TYPE.toLowerCase()];if(null!=o)o===s.RESOURCE_TYPES.ITEM?n=r.SyncResourceType.item:o===s.RESOURCE_TYPES.COLLECTION&&(n=r.SyncResourceType.collection);else if(this.common.isString(t))try{var i=JSON.parse(t);n=this.common.isArray(i)?r.SyncResourceType.collection:r.SyncResourceType.item}catch(e){n=r.SyncResourceType.file}return n}},{key:"getUri",value:function(e,t){var n=e&&e.headers?e.headers[s.HEADERS.LOCATION.toLowerCase()]:null;if(null!=n)return"/"+n;var o=null;if(e.data&&(o="string"==typeof e.data?""!=e.data?JSON.parse(e.data):null:e.data),o&&o[i.McsRequestHandler.URI_KEY]){var r=o[i.McsRequestHandler.URI_KEY];return delete o[i.McsRequestHandler.URI_KEY],r}return this.options.parseURL(t).path}},{key:"createResource",value:function(e,t,n,o,i,a,u,c){var l=c.headers[s.HEADERS.LOCATION.toLowerCase()];l=null!=l?"/"+l:t;r.SyncResourceType.file;var h=i[s.HEADERS.ORACLE_MOBILE_SYNC_RESOURCE_TYPE.toLowerCase()];if(null!=h)h==s.RESOURCE_TYPES.ITEM?r.SyncResourceType.item:h==s.RESOURCE_TYPES.COLLECTION&&r.SyncResourceType.collection;else if(this.common.isString(u))try{var f=JSON.parse(u);this.common.isArray(f)?r.SyncResourceType.collection:r.SyncResourceType.item}catch(e){r.SyncResourceType.file}return null}}]),e}()},{"../../types":41,"../sync-express/mcs-request-handler":37,"../sync-resource-type":39}],36:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.DB=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=e("../../logger");n.DB=function(){function e(t,n){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.name=t,this.$options=n,this._db=null,this.options={autosave:!0,autosaveInterval:500,autoload:!0,adapter:null},this.logger=new r.Logger("DB"),n.isCordova&&("function"==typeof LokiCordovaFSAdapter?this.options.adapter=new LokiCordovaFSAdapter({prefix:"loki"}):this.logger.warn("LokiCordovaFSAdapter is not installed")),n.isCordova?n.deviceReady(function(){o.init()}):n.ready(this.init.bind(this))}return o(e,[{key:"init",value:function(e){!0!==this.$options.off&&!0!==this.$options.isTest||(this.options={autosave:!1,autosaveInterval:31104e6,autoload:!1,adapter:null});var t=this.name||e||this.$options.offlineDBName||"offline";this._db=new loki(t,this.options),this._db.loadDatabase()}},{key:"getCollectionByName",value:function(e){var t=this._db.getCollection(e);if(!t){t=this._db.addCollection(e,{clone:!0,disableChangesApi:!0,transactional:!0})}return t}},{key:"getCollection",value:function(e){var t=this;return new Promise(function(n){t._db.loadDatabase({},function(){var o=t._db.getCollection(e);if(!o){o=t._db.addCollection(e)}n(o)})})}},{key:"saveDatabase",value:function(){this._db.save()}},{key:"getCollections",value:function(){return this._db.listCollections()}},{key:"internalDB",value:function(){return this._db}},{key:"close",value:function(e){this._db.close(e)}},{key:"flush",value:function(){var e=this;return new Promise(function(t){for(var n=e.getCollections(),o=0;o<n.length;o++)e.getCollectionByName(n[o].name).removeDataOnly();t(!0)})}}]),e}()},{"../../logger":13}],37:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.McsRequestHandler=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=e("./request-handler");var i=n.McsRequestHandler=function(e){function t(e,n,o){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"mcs-request",e,n,o))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.RequestHandler),o(t,[{key:"buildResponseObject",value:function(e){return e}},{key:"getResponsePayload",value:function(e){return e.data}},{key:"getModuleName",value:function(){return"MCS"}},{key:"isPersistentGetRequest",value:function(e){(function e(t,n,o){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,n);if(void 0===r){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,o)}if("value"in r)return r.value;var s=r.get;return void 0!==s?s.call(o):void 0})(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"isPersistentGetRequest",this).call(this,e);var n=t.HEADER_RESOURCE_TYPE in e||e.headers[t.HEADER_RESOURCE_TYPE];if("collection"===n){if(this.$common.isEmpty(e.data))throw new Error("cannot proceed with empty payload");if(!("items"in e.data))throw new Error("items is not in the payload returned from MCS, probably not Sync Custom Code");if(!("uris"in e.data))throw new Error("url is not in the payload returned from MCS, probably not Sync Custom Code");if(!("etags"in e.data))throw new Error("etags is not in the payload returned from MCS, probably not Sync Custom Code")}else if("item"!==n)throw new Error("oracle-mobile-sync-resource-type is not in the headers returned from MCS, probably not Sync Custom Code");return!0}},{key:"handleMcsGetCollectionPayload",value:function(e,n){for(var o=e.items.length,r=Date.now(),i=0;i<o;i++){var s=e.items[i];s[t.URI_KEY]=parseUri((this.$common.stringStartsWith(e.uris[i],"/")?"":"/")+e.uris[i]).path,s[t.ETAG_KEY]=e.etags[i];var a={};a[t.URI_KEY]=s[t.URI_KEY];var u=n.findOne(a);u?(this.$common.extendOwn(u,s),n.update(u)):n.insert(s)}return n.removeWhere(function(e){return e.meta.updated<r}),n.find()}},{key:"handleMcsGetItemPayload",value:function(e,n,o){var r={};r[t.URI_KEY]=o;var i=e.findOne(r);if(i){var s=n;return this.$common.extendOwn(i,s),e.update(i)}return(s=n)[t.URI_KEY]=o,e.insert(s)}},{key:"handleGet",value:function(e){var n=this.$options.isPersistentUrl(e.url);if(!1===n)throw new Error("Persistence.handleMcsGet()-> URI was not configured for persistence:"+e.url);var o=this.$db.getCollectionByName(n.root);if(this.$common.isEmpty(n.params)){var r=o.find(),i={items:[],uris:[],etags:[]};for(var s in r){r[s].hasOwnProperty(t.URI_KEY)&&(i.uris.push(r[s][t.URI_KEY]),delete r[s][t.URI_KEY]),r[s].hasOwnProperty(t.ETAG_KEY)&&(i.etags.push(r[s][t.ETAG_KEY]),delete r[s][t.ETAG_KEY]);var a=this.$common.cleanObject(r[s]);i.items.push(a)}return i}var u={};return u[t.URI_KEY]=n.path,this.$common.cleanObject(o.findOne(u))}},{key:"handleGetStore",value:function(e){var n=this.$options.isPersistentUrl(e.url);if(!1===n)throw new Error("Persistence.handleMcsGetStore()-> URI was not configured for persistence:"+e.url);var o=this.$db.getCollectionByName(n.root),r=e.data,i=t.HEADER_RESOURCE_TYPE in e||e.headers[t.HEADER_RESOURCE_TYPE];if("collection"===i)return this.handleMcsGetCollectionPayload(r,o);if("item"===i)return this.handleMcsGetItemPayload(o,r,n.path);throw i?(this.logger.error("unknown Oracle-Mobile-Sync-Resource-Type (%s)",i),new Error("unknown Oracle-Mobile-Sync-Resource-Type")):(this.logger.error("this is not MCS response, unable to handle the payload, no MCS header was specified: ",e),new Error("this is not MCS response, unable to handle the payload, no MCS header was specified"))}},{key:"handlePost",value:function(e,n){var o=this.$options.isPersistentUrl(e.url);if(!1===o)throw new Error("Persistence.handleMcsPost()-> URI was not configured for persistence:"+e.url);var r=this.$db.getCollectionByName(o.root),i=e.data;if(!this.$common.isEmpty(o.params))throw new Error("you can add new objects only against the root REST resource endpoint");if(this.$common.isArray(i))throw new Error("the payload cannot be array");if(this.$common.isObject(i)&&!this.$common.isNull(i)&&!this.$common.isFunction(i)){if(e.data&&e.data[t.URI_KEY])return this.updatePayloadWithNewUri(r,e);var s=null;e&&e.headers&&e.headers[t.HEADER_LOCATION]&&(s=this.$common.stringStartsWith(e.headers[t.HEADER_LOCATION],"/")?e.headers[t.HEADER_LOCATION]:"/"+e.headers[t.HEADER_LOCATION]);var a=null;if(s){var u={};u[t.URI_KEY]=s,a=r.findOne(u)}if(a?this.$common.extendOwn(a,e.data):(i[t.ETAG_KEY]='"0-1B2M2Y8AsgTpgAmY7PhCfg"',a=r.insert(i),this.markObjAsOfflineIfForced(a,n)),!s){var c=o.tokens.length>0&&/^\w+$/.test(o.tokens[0].name)?o.tokens[0].name:null,l=null;c&&(l=e.data.hasOwnProperty(c)?e.data[c]:this.$common.getUID()),s=null===l?o.root+"/"+this.$common.getUID():o.root+"/"+l}return a[t.URI_KEY]=s,r.update(a)}throw new Error("don't know what to do with the payload")}},{key:"updatePayloadWithNewUri",value:function(e,n){var o={};o[t.URI_KEY]=n.data[t.URI_KEY];var r=e.findOne(o);if(r)return this.$common.extendOwn(r,n.data),r[t.URI_KEY]=this.$common.stringStartsWith(n.headers[t.HEADER_LOCATION],"/")?n.headers[t.HEADER_LOCATION]:"/"+n.headers[t.HEADER_LOCATION],e.update(r);throw new Error("the payload was not found in collection:"+o[t.URI_KEY])}},{key:"handlePut",value:function(e,n){var o=this.$options.isPersistentUrl(e.url);if(!1===o)throw new Error("Persistence.handleMcsPut()-> URI was not configured for persistence:"+e.url);var r=this.$db.getCollectionByName(o.root),i=e.data;if(!this.$common.isEmpty(o.params)){if(this.$common.isArray(i))throw new Error("the payload cannot be array");if(this.$common.isObject(i)&&!this.$common.isNull(i)&&!this.$common.isFunction(i)){var s={};s[t.URI_KEY]=o.path;var a=r.findOne(s);if(a)return this.$common.extendOwn(a,i),this.markObjAsOfflineIfForced(a,n),r.update(a)}}throw new Error("you can execute update operations only against existing items in the offline database!")}},{key:"handleDelete",value:function(e){var n=this.$options.isPersistentUrl(e.url);if(!1===n)throw new Error("Persistence.handleMcsDelete()-> URI was not configured for persistence:"+e.url);var o=this.$db.getCollectionByName(n.root);e.data;if(!this.$common.isEmpty(n.params)){var r={};r[t.URI_KEY]=n.path;var i=o.findOne(r);if(i)return o.remove(i);throw new Error("unable to find object with the given ID(%s) in the database")}}},{key:"data",value:function(e){return new Promise(function(t){return t(function(e){var t=this.$options.isPersistentUrl(e);if(!t)throw new Error("Persistence.BaseModule.data() given URI not configured for persistence: "+e);return this.$db.getCollectionByName(t.root)}(e))})}},{key:"router",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Promise(function(o){if(!t.$common.isObject(e))throw console.error("Passed object is not defined request!",e),new Error("Passed object is not defined request!");if(!e.hasOwnProperty("method"))throw t.logger.error("request.method was not provided!",e),new Error("request.method was not provided!");var r=t.$common.clone(e);if(r.method=t.$utils._normalizeMethod(r.method),!t[r.method])throw t.logger.error("specified router is not implemented!"),new Error("specified router is not implemented!");o(t[r.method](r,n))})}},{key:"get",value:function(e){var t=this;return new Promise(function(n){n(function(e){t.logger.info("get()"),t.isPersistentRequest(e);var n=t.$common.clone(e);return!n.hasOwnProperty("data")||t.$common.isEmpty(n.data)?t.$common.clone(t.handleGet(n)):(t.isPersistentGetRequest(e),t.$common.clone(t.handleGetStore(n)))}(e))})}}]),t}();i.URI_KEY="$mcs$mcsPersistenceURI",i.ETAG_KEY="$mcs$etag",i.HEADER_LOCATION="location",i.HEADER_RESOURCE_TYPE="oracle-mobile-sync-resource-type"},{"./request-handler":38}],38:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.RequestHandler=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=e("./db"),i=e("../../logger");n.RequestHandler=function(){function e(t,n,o,s){var a=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.dbname=t,this.$options=n,this.$common=o,this.$utils=s,this.logger=new i.Logger("RequestHandler"),this.prefix=n.dbPrefix,this.$db=new r.DB(this.prefix+"."+this.dbname,n),n.onDbPrefixChange=function(e,t){a.$db=new r.DB(t+"."+a.dbname,n)}}return o(e,[{key:"isPersistentRequest",value:function(e){if(!e)throw new Error("request cannot be undefined or null value");if(!this.$common.isObject(e))throw new Error("request has to be defined object with properties like: url, data etc.");if(this.$common.isEmpty(e))throw new Error("request cannot be empty object, it request properties like: url, data etc.");if(this.$common.isArray(e)||this.$common.isFunction(e))throw new Error("request cannot be array or function");if(!("url"in e))throw new Error("request.url was not specified");return!0}},{key:"isPersistentGetRequest",value:function(e){return this.isPersistentRequest(e),!0}},{key:"isPostRequest",value:function(e){if(this.isPersistentRequest(e),!("data"in e))throw new Error("request.data was not defined!");if(!this.$common.isObject(e.data))throw new Error("request.data is not a object or array!");if(this.$common.isFunction(e.data))throw new Error("request.data cannot be function");return!0}},{key:"isOfflinePersistObj",value:function(e){return!!("meta"in e&&e.meta.hasOwnProperty("offline-persist"))}},{key:"isLokiDbObj",value:function(e){return!(!("$loki"in e&&"number"==typeof e.$loki)||isNaN(e.$loki))}},{key:"buildFindQueryBasedOnUrlParams",value:function(e){var t={};e.attr.length>0&&(t[e.attr[0].name]=e.attr[0].pattern.indexOf("d")>=0?parseInt(e.attr[0].value):e.attr[0].value+"");return t}},{key:"buildUniqueIDValue",value:function(e,t){var n=function(){return e.uri.tokens.length>1&&e.uri.tokens[e.uri.tokens.length-1].pattern.indexOf("d")>=0},o=function(e){return n()?parseInt(e):e+""};return this.$common.isEmpty(t)?o(this.$common.getUID()):"number"==typeof t&&n()?t:o(t)}},{key:"handleGetRootArrayPayload",value:function(e,t,n){var o=this;if(t.uri.tokens.length>1){if(n.find().length>0){var r=t.uri.tokens[1].name;return n.removeWhere(function(t){var i=e.findIndex(function(e){return e[r]===t[r]});if(!(i>-1))return!o.isOfflinePersistObj(t);try{o.isOfflinePersistObj(t)?t=o.$common.deepExtend(e[i],t):o.$common.extendOwn(t,e[i]),n.update(t),e.splice(i,1)}catch(e){o.logger.error(e)}finally{return!1}}),e.forEach(function(e){o.isLokiDbObj(e)?n.update(e):n.insert(e)}),n.find()}return n.insert(e)}return n.removeWhere(function(e){return!o.isOfflinePersistObj(e)}),n.insert(e)}},{key:"handleGetRootObjectPayload",value:function(e,t,n){var o=this;if(t.uri.tokens.length>1){var r=t.uri.tokens[1].name;if(!e.hasOwnProperty(r))throw this.logger.error("payload does not contain unique key specified in the URL settings"),new Error("payload does not contain unique key specified in the URL settings");var i={};i[r]=e[r];var s=n.findOne(i);return s?(this.isOfflinePersistObj(s)?s=this.$common.deepExtend(e,s):this.$common.extendOwn(s,e),n.update(s)):n.insert(e)}return n.removeWhere(function(e){return!o.isOfflinePersistObj(e)}),n.insert(e)}},{key:"buildNestedPropertySearchString",value:function(e){var t="";if(e.attr.length>1)for(var n=1;n<e.attr.length;n++)e.attr[n].is?t.length>0?t+="."+e.attr[n].name:t+=e.attr[n].name:t.length>0?t+="."+e.attr[n].name+"["+e.attr[n].value+"]":t+=e.attr[n].value;return t}},{key:"buildNestedPropertyArrayParams",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=[],r=t.attr;if(Array.isArray(r)&&r.length>0)for(var i=e.uri.tokens.length>1?e.uri.tokens.slice(1):[],s=0;s<r.length;s++){var a=r.length-1==s;if(r[s].is){if(o.push({name:r[s].name,value:null,isProperty:!0,isInteger:!1}),a&&i[s+1]&&n){var u=this.$utils.isUrlRegexInteger(i[s+1].pattern);o.push({name:i[s+1].name,value:u?this.$common.getUID():this.$common.getUID()+"",isProperty:!1,isInteger:u})}}else{var c=r[s].value||this.$common.getUID();o.push({name:r[s].name,value:c,isProperty:!1,isInteger:this.$utils.isUrlRegexInteger(i[s].pattern)})}}return o}},{key:"createObjFromUrlParamsForExistingForPost",value:function(e,t,n,o,r){var i=this.buildNestedPropertyArrayParams(t,n),s=e;if(Array.isArray(i)&&i.length>0){var a;if(r){var u=this.getKeyForCurrentObject(t,n);a={key:u,value:r[u.name]}}s=this.$utils.setNestedProperty2(e,i,o,a)}else this.$common.extendOwn(e,o);return{obj:e,result:s}}},{key:"getKeyForCurrentObject",value:function(e,t){var n=t.attr.length;return e.uri.tokens[n+1]}},{key:"createObjFromUrlParamsForGETAction",value:function(e,t,n,o){var r=this.buildNestedPropertyArrayParams(t,n,!1),i=e;return Array.isArray(r)&&r.length>0&&(i=this.$utils.setNestedProperty2(e,r,o)),{obj:e,result:i}}},{key:"getNestedPropertyFromUrlParamsForExisting",value:function(e,t,n){var o=this.buildNestedPropertyArrayParams(t,n,!1);return Array.isArray(o)&&o.length>0?this.$utils.getNestedProperty(e,o):e}},{key:"markObjAsOfflineIfForced",value:function(e,t){return t?(this.isOfflinePersistObj(e)&&delete e.meta["offline-persist"],e):"meta"in e?(e.meta["offline-persist"]=!0,e):(e.meta={},e.meta["offline-persist"]=!0,e)}},{key:"handleGet",value:function(e){var t=this.$options.parseURL(e.url),n=this.$utils.isPersistUrl(t.path);if(!n)throw new Error("Persistence.RequestHandler.get() given URI was not configured for persistence:"+t.path);var o=this.$utils.extractKeyValuesFromUrl2(n),r=this.$db.getCollectionByName(o.root),i=this.buildFindQueryBasedOnUrlParams(o);if(this.$common.isEmpty(i)){this.logger.debug("return all from db");var s=this.$common.cleanObjects(r.find());return this.buildResponseObject(s)}var a=r.findOne(i);if(a){var u=this.getNestedPropertyFromUrlParamsForExisting(a,n,o),c=this.$common.cleanObject(u);return this.buildResponseObject(c)}return null}},{key:"handleGetStore",value:function(e){var t=this.$options.parseURL(e.url),n=this.$utils.isPersistUrl(t.path);if(!n)throw new Error("Persistence.RequestHandler.get() given URI was not configured for persistence:"+t.path);var o=this.$utils.extractKeyValuesFromUrl2(n),r=this.$db.getCollectionByName(o.root),i=this.getResponsePayload(e),s=this.buildFindQueryBasedOnUrlParams(o);if(this.$common.isEmpty(s)){if(!this.$common.isArray(i)||this.$common.isFunction(i)||this.$common.isEmpty(i)){if(!this.$common.isObject(i)||this.$common.isArray(i)||this.$common.isFunction(i)||this.$common.isEmpty(i))throw this.logger.error("handleGetStore","unknown or empty object passed for the operation"),new Error("RequestHandler.handleGetStore -> unknown or empty object passed for the operation");return this.handleGetRootObjectPayload(i,n,r)}var a=this.handleGetRootArrayPayload(i,n,r);return this.buildResponseObject(a)}var u=r.findOne(s),c=void 0;return u?(c=this.createObjFromUrlParamsForGETAction(u,n,o,i),r.update(c.obj)):(c=this.createObjFromUrlParamsForGETAction(s,n,o,i),r.insert(c.obj)),this.buildResponseObject(c.result)}},{key:"handlePostRootArrayPayload",value:function(e,t,n,o){var r=this,i=t.uri.tokens.length>1?t.uri.tokens[1].name:null;return e.forEach(function(e){if(r.isLokiDbObj(e))r.markObjAsOfflineIfForced(e,o),n.update(e);else{if(!i||!e.hasOwnProperty(i)){var s=n.insert(e);return s[i]=r.buildUniqueIDValue(t),r.markObjAsOfflineIfForced(s,o),r.$common.cleanObject(n.update(s))}var a=n.findOne({keyNameToCompare:e[i]});a?(r.$common.extendOwn(a,e),r.markObjAsOfflineIfForced(a,o),n.update(a)):(r.markObjAsOfflineIfForced(e,o),n.insert(e))}}),this.$common.cleanObjects(n.find())}},{key:"handlePostRootObjectPayload",value:function(e,t,n,o){var r=t.uri.tokens.length>1?t.uri.tokens[1].name:"";if(r&&!e.hasOwnProperty(r)){this.logger.info("get payload","does not have the key specified in the URL settings"),e[r]="";var i=n.insert(e);if(i)return i[r]=this.buildUniqueIDValue(t),this.markObjAsOfflineIfForced(i,o),this.$common.cleanObject(n.update(i));throw new Error("unable to store the payload object")}if(r&&e.hasOwnProperty(r)){var s={};s[r]=e[r];var a=n.findOne(s);if(a)return this.$common.extendOwn(a,e),this.markObjAsOfflineIfForced(a,o),this.$common.cleanObject(n.update(a));e[r]=this.buildUniqueIDValue(t,e[r])}return this.markObjAsOfflineIfForced(e,o),this.$common.cleanObject(n.insert(e))}},{key:"handlePost",value:function(e,t){var n=this.$options.parseURL(e.url),o=this.$utils.isPersistUrl(n.path);if(!o)throw new Error("Persistence.RequestHandler.post() given URI not configured for persistence: "+n.path);var r=this.$utils.extractKeyValuesFromUrl2(o),i=this.$db.getCollectionByName(r.root),s=e.data,a=this.buildFindQueryBasedOnUrlParams(r);if(!this.$common.isEmpty(a)){var u=i.findOne(a);if(u){var c=this.createObjFromUrlParamsForExistingForPost(u,o,r,s),l=o.uri.tokens[o.uri.tokens.length-1].name;return c.result[l]=this.buildUniqueIDValue(o,c.result[l]),this.markObjAsOfflineIfForced(c.obj,t),i.update(c.obj),this.$common.cleanObject(c.result)}c=this.createObjFromUrlParamsForExistingForPost(a,o,r,s);return this.markObjAsOfflineIfForced(c.obj,t),i.insert(c.obj),this.$common.cleanObject(c.result)}if(this.$common.isArray(s))return this.handlePostRootArrayPayload(s,o,i,t);if(this.$common.isObject(s)&&!this.$common.isArray(s)&&!this.$common.isNull(s))return this.handlePostRootObjectPayload(s,o,i,t);throw new Error("don't know what to do with the payload")}},{key:"handlePut",value:function(e,t){var n=this.$options.parseURL(e.url),o=this.$utils.isPersistUrl(n.path);if(!o)throw new Error("Persistence.RequestHandler.post() given URI not configured for persistence: "+n.path);var r=this.$utils.extractKeyValuesFromUrl2(o),i=this.$db.getCollectionByName(r.root),s=e.data,a=this.buildFindQueryBasedOnUrlParams(r);if(!this.$common.isEmpty(a)){var u=i.findOne(a);if(u){var c=this.createObjFromUrlParamsForExistingForPost(u,o,r,s);return this.markObjAsOfflineIfForced(c.obj,t),i.update(c.obj),c.result}c=this.createObjFromUrlParamsForExistingForPost(a,o,r,s);return this.markObjAsOfflineIfForced(c.obj,t),i.insert(c.obj),c.result}if(this.$common.isArray(s))return this.handlePostRootArrayPayload(s,o,i,t);if(this.$common.isObject(s)&&!this.$common.isArray(s)&&!this.$common.isNull(s))return this.handlePostRootObjectPayload(s,o,i,t);throw new Error("no key specified to recognise obj in the database for editing!")}},{key:"handlePatch",value:function(e,t){var n=this.$options.parseURL(e.url),o=this.$utils.isPersistUrl(n.path);if(!o)throw new Error("Persistence.RequestHandler.post() given URI not configured for persistence: "+n.path);var r=this.$utils.extractKeyValuesFromUrl2(o),i=this.$db.getCollectionByName(r.root),s=e.data,a=this.buildFindQueryBasedOnUrlParams(r);if(!this.$common.isEmpty(a)){var u=i.findOne(a);if(u){var c=this.createObjFromUrlParamsForExistingForPost(u,o,r,s);return this.markObjAsOfflineIfForced(c.obj,t),i.update(c.obj),c.result}c=this.createObjFromUrlParamsForExistingForPost(a,o,r,s);return this.markObjAsOfflineIfForced(c.obj,t),i.insert(c.obj),c.result}if(this.$common.isArray(s))return this.handlePostRootArrayPayload(s,o,i,t);if(this.$common.isObject(s)&&!this.$common.isArray(s)&&!this.$common.isNull(s))return this.handlePostRootObjectPayload(s,o,i,t);throw new Error("no key specified to recognise obj in the database for editing!")}},{key:"handleDelete",value:function(e){var t=this.$options.parseURL(e.url),n=this.$utils.isPersistUrl(t.path);if(!n)throw new Error("Persistence.RequestHandler.post() given URI not configured for persistence: "+t.path);var o=this.$utils.extractKeyValuesFromUrl2(n),r=this.$db.getCollectionByName(o.root),i=this.buildFindQueryBasedOnUrlParams(o);if(!this.$common.isEmpty(i)){if(a=r.findOne(i))return this.$common.cleanObject(r.remove(a));throw new Error("unable to find object with the given ID(%s) in the database")}if(e.hasOwnProperty("data")){var s=e.data;if(!this.$common.isEmpty(s)&&this.$common.isObject(s)&&!this.$common.isArray(s)){var a,u=n.uri.tokens.length>1?n.uri.tokens[1].name:null;if(u&&!e.data.hasOwnProperty(u))throw new Error("payload does not have the key required to delete the object");if(a=r.findOne({keyNameToCompare:e.data[u]}))return this.$common.cleanObject(r.remove(a))}}throw this.logger.error("payload does not have the key required to delete the object in the payload"),new Error("payload does not have the key required to delete the object in the payload")}},{key:"postSuccessOperations",value:function(e){if("POST"===e.syncObj.method){var t=this.$common.clone(e),n=this.$options.parseURL(t.syncObj.url),o=this.$utils.isPersistUrl(n.path);if(!o)return this.logger.debug("sync post success operation exist"),e;var r=this.$utils.extractKeyValuesFromUrl2(o),i=this.$db.getCollectionByName(r.root),s=t.syncObj.data,a=t.response,u=this.buildFindQueryBasedOnUrlParams(r);if(this.$common.isEmpty(u)){var c=o.uri.tokens.length>1?o.uri.tokens[1].name:"";if(c&&!s.hasOwnProperty(c))return a=this.$common.extendOwn(s,a),this.$common.cleanObject(i.insert(a));var l={};l[c]=s[c];var h=i.findOne(l);return this.$common.extendOwn(h,a),this.$common.cleanObject(i.update(h))}var f=i.findOne(u);if(f){var d=this.createObjFromUrlParamsForExistingForPost(f,o,r,a,s),p=o.uri.tokens[o.uri.tokens.length-1].name;return d.result[p]=this.buildUniqueIDValue(o,d.result[p]),i.update(d.obj),this.$common.cleanObject(d.result)}var y=this.createObjFromUrlParamsForExistingForPost(u,o,r,a);return i.insert(y.obj),this.$common.cleanObject(y.result)}return e}},{key:"flush",value:function(e){var t=this;if(this.logger.info("Persistence.RequestHandler.flush()",e),this.$common.isEmpty(e))return this.$db.flush();var n=this.$options.parseURL(e),o=this.$utils.isPersistUrl(n.path);return new Promise(function(e,r){if(o){var i=t.$utils.extractKeyValuesFromUrl2(o);e(t.$db.getCollectionByName(i.root).removeDataOnly())}else r(new Error("Persistence.RequestHandler.flush() given URI not configured for persistence: "+n.path))})}},{key:"getDB",value:function(){return this.$db}},{key:"get",value:function(e){var t=this;return new Promise(function(n){n(function(e){t.logger.info("get()"),t.isPersistentGetRequest(e);var n=t.$common.clone(e);return!n.hasOwnProperty("data")||t.$common.isEmpty(n.data)?t.$common.clone(t.handleGet(n)):t.$common.clone(t.handleGetStore(n))}(e))})}},{key:"post",value:function(e,t){var n=this;return new Promise(function(o){o(function(e,t){n.logger.info("post()"),n.isPostRequest(e);var o=n.$common.clone(e);return n.$common.clone(n.handlePost(o,t))}(e,t))})}},{key:"put",value:function(e,t){var n=this;return new Promise(function(o){o(function(e,t){n.logger.info("put()"),n.isPostRequest(e);var o=n.$common.clone(e);return n.$common.clone(n.handlePut(o,t))}(e,t))})}},{key:"patch",value:function(e,t){var n=this;return new Promise(function(o){o(function(e,t){n.logger.info("patch()"),n.isPostRequest(e);var o=n.$common.clone(e);return n.$common.clone(n.handlePatch(o,t))}(e,t))})}},{key:"delete",value:function(e){var t=this;return new Promise(function(n){n(function(e){t.logger.info("delete()"),t.isPersistentRequest(e);var n=t.$common.clone(e);return t.$common.clone(t.handleDelete(n))}(e))})}},{key:"data",value:function(e){var t=this;return new Promise(function(n){n(function(e){if(t.logger.info("data()"),null==e)throw new Error("Path cannot be empty!");var n=t.$options.parseURL(e),o=t.$utils.isPersistUrl(n.path);if(!o)throw new Error("post() given URI not configured for persistence: "+n.path);var r=t.$utils.extractKeyValuesFromUrl2(o);return t.$db.getCollectionByName(r.root)}(e))})}},{key:"router",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new Promise(function(o){if(!t.isPersistentGetRequest(e))throw t.logger.error("Passed object is not defined request for GET!",e.url),new Error("Passed object is not defined request for GET!");if(!e.hasOwnProperty("method"))throw t.logger.error("request.method was not provided!",e),new Error("request.method was not provided!");var r=t.$common.clone(e);if(r.method=t.$utils._normalizeMethod(r.method),!t[r.method])throw t.logger.error("specified router is not implemented!"),new Error("specified router is not implemented!");o(t[r.method](r,n))})}}]),e}()},{"../../logger":13,"./db":36}],39:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.SyncResourceType={item:0,collection:1,file:2}},{}],40:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.Synchronization=void 0;var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=e("./endpoint/mobile-endpoint"),i=e("../logger");var s=function(){function e(t,n,o,r,s,a,u){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.config=n,this.utils=o,this.platform=r,this.common=s,this.options=a,this.process=u,this._endpoints={},this.logger=new i.Logger("Synchronization"),this.backend=t,a._originalIsOnline||(a._originalIsOnline=a.isOnline.bind(a));var c=!1;a.isOnline=function(){return!1===c?a._originalIsOnline():!c},this.setOfflineMode=function(e){c="boolean"!=typeof e||e}}return o(e,[{key:"isOnline",value:function(){return this.options.isOnline()}},{key:"purge",value:function(){for(var e in this._endpoints)if(this._endpoints.hasOwnProperty(e)){var t=this._endpoints[e];for(var n in t)t.hasOwnProperty(n)&&t[n].purge()}}},{key:"openEndpoint",value:function(e,t){return this._endpoints[e]=this._endpoints[e]||{},this._endpoints[e][t]=this._endpoints[e][t]||new r.MobileEndpoint(this,e,t,this.backend,this.utils,this.platform,this.common,this.options),this._endpoints[e][t]}},{key:"_run",value:function(e){return this.process.run(e)}},{key:"_runWithoutReadInBackground",value:function(e){return this.process.runWithoutReadInBackground(e)}}]),e}();n.Synchronization=s},{"../logger":13,"./endpoint/mobile-endpoint":27}],41:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.HEADERS={ORACLE_MOBILE_DIAGNOSTIC_SESSION_ID:"Oracle-Mobile-DIAGNOSTIC-SESSION-ID",ORACLE_MOBILE_DEVICE_ID:"Oracle-Mobile-DEVICE-ID",ORACLE_MOBILE_CLIENT_REQUEST_TIME:"Oracle-Mobile-CLIENT-REQUEST-TIME",ORACLE_MOBILE_ANALYTICS_APPLICATION_ID:"Oracle-Mobile-Analytics-Application-Id",ORACLE_MOBILE_NAME:"Oracle-Mobile-Name",ORACLE_MOBILE_CREATED_BY:"Oracle-Mobile-Created-By",ORACLE_MOBILE_CREATED_ON:"Oracle-Mobile-Created-On",ORACLE_MOBILE_MODIFIED_BY:"Oracle-Mobile-Modified-By",ORACLE_MOBILE_MODIFIED_ON:"Oracle-Mobile-Modified-On",ORACLE_MOBILE_SYNC_RESOURCE_TYPE:"Oracle-Mobile-Sync-Resource-Type",ORACLE_MOBILE_SYNC_AGENT:"Oracle-Mobile-Sync-Agent",LOCATION:"Location",ORACLE_MOBILE_BACKEND_ID:"Oracle-Mobile-Backend-Id",ORACLE_MOBILE_SOCIAL_IDENTITY_PROVIDER:"Oracle-Mobile-Social-Identity-Provider",ORACLE_MOBILE_SOCIAL_ACCESS_TOKEN:"Oracle-Mobile-Social-Access-Token",ORACLE_MOBILE_CLIENT_SDK_INFO:"Oracle-Mobile-Client-SDK-Info",ACCEPT:"Accept",CONTENT_TYPE:"Content-Type",E_TAG:"ETag",IF_MATCH:"If-Match",AUTHORIZATION:"Authorization",X_USER_IDENTITY_DOMAIN_NAME:"X-USER-IDENTITY-DOMAIN-NAME",X_RESOURCE_IDENTITY_DOMAIN_NAME:"X-RESOURCE-IDENTITY-DOMAIN-NAME",ACCEPT_ENCODING:"Accept-Encoding"},n.CONTENT_TYPES={APPLICATION_JSON:"application/json",TEXT_PLAIN:"text/plain",X_WWW_FORM_FORM_URLENCODED:"application/x-www-form-urlencoded; charset=utf-8"},n.HTTP_METHODS={GET:"GET",PUT:"PUT",PATCH:"PATCH",POST:"POST",DELETE:"DELETE",HEAD:"HEAD"},n.RESOURCE_TYPES={ITEM:"item",COLLECTION:"collection",FILE:"file"},n.AUTHENTICATION_TYPES={basic:"basic",oauth:"oauth",facebook:"facebook",token:"token"},n.MODULE_NAMES={STORAGE:"Storage",AUTHORIZATION:"Authorization",USER_MANAGEMENT:"UserManagement",APP_POLICES:"AppPolicies",LOCATION:"Location",SYNC:"Sync",SYNC_EXPRESS:"SyncExpress",NOTIFICATIONS:"Notifications",MCS_ANALYTICS:"MCSAnalytics",ANALYTICS:"Analytics",CUSTOM_CODE:"CustomCode",APP_CONFIG:"AppConfig"},n.PLATFORM_NAMES={JAVASCRIPT:"Javascript",CORDOVA:"Cordova"},n.PLATFORM_ID={ANDROID:"android",IOS:"ios"},n.NOTIFICATION_PROVIDER={FCM:"FCM",APNS:"APNS",WNS:"WNS",SYNIVERSE:"SYNIVERSE"},n.XML_HTTP_REQUEST_RESPONSE_TYPE={JSON:"json",BLOB:"blob"}},{}],42:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();(n.Utils=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return o(e,[{key:"removeSpace",value:function(e){return e.replace(/ /g,"")}},{key:"uuid",value:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})}},{key:"validateConfiguration",value:function(e){var t=e;return/\s/.test(t)&&t&&(t=this.removeSpace(e)),t}},{key:"encodeBase64",value:function(t){for(var n,o,r,i,s,a="",u="",c="",l=0;r=(n=t.charCodeAt(l++))>>2,i=(3&n)<<4|(o=t.charCodeAt(l++))>>4,s=(15&o)<<2|(u=t.charCodeAt(l++))>>6,c=63&u,isNaN(o)?s=c=64:isNaN(u)&&(c=64),a=a+e.KEY_STR.charAt(r)+e.KEY_STR.charAt(i)+e.KEY_STR.charAt(s)+e.KEY_STR.charAt(c),n=o=u="",r=i=s=c="",l<t.length;);return a}},{key:"decodeBase64",value:function(t){var n,o,r,i,s="",a="",u="",c=0;if(/[^A-Za-z0-9\+\/\=]/g.exec(t))return null;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");n=e.KEY_STR.indexOf(t.charAt(c++))<<2|(r=e.KEY_STR.indexOf(t.charAt(c++)))>>4,o=(15&r)<<4|(i=e.KEY_STR.indexOf(t.charAt(c++)))>>2,a=(3&i)<<6|(u=e.KEY_STR.indexOf(t.charAt(c++))),s+=String.fromCharCode(n),64!=i&&(s+=String.fromCharCode(o)),64!=u&&(s+=String.fromCharCode(a)),n=o=a="",r=i=u="",c<t.length;);return s}},{key:"hasValue",value:function(e,t,n){return e.hasOwnProperty(t)&&e[t]===n}},{key:"isEquivalentURL",value:function(e,t){return 0===e.indexOf("https")&&0===t.indexOf("https")?(e=443===this.getPort(e)?e.replace(":443",""):e,t=443===this.getPort(t)?t.replace(":443",""):t):-1===e.indexOf("https")&&-1===t.indexOf("https")&&(e=80===this.getPort(e)?e.replace(":80",""):e,t=80===this.getPort(t)?t.replace(":80",""):t),0===e.indexOf(t)}},{key:"getPort",value:function(e){var t=e.indexOf(":",7),n=e.indexOf("/",t);t>0&&-1==n&&(n=e.length);var o=e.substr(t+1,n-t-1);return o&&!isNaN(1*o)?1*o:-1}},{key:"parseHeaders",value:function(e){var t={};if(!e)return t;for(var n=e.split("\r\n"),o=0,r=n.length;o<r;o++){var i=n[o],s=i.indexOf(": ");s>0&&(t[i.substring(0,s).toLowerCase()]=i.substring(s+2))}return t}},{key:"normalizeHeaderKeys",value:function(e){var t={};if(this.isArray(e))for(var n=e,o=0;o<n.length;o++)t[n[o].name.toLowerCase()]=n[o].value;else for(var r in e)e.hasOwnProperty(r)&&(t[r.toLowerCase()]=e[r]);return t}},{key:"isArray",value:function(e){return"[object Array]"===Object.prototype.toString.call(e)}},{key:"isCordova",value:function(){return void 0!==window.cordova}},{key:"strEndsWith",value:function(e,t){return e.match(t+"$")==t}},{key:"hashCode",value:function(e){return e.split("").reduce(function(e,t){return(e=(e<<5)-e+t.charCodeAt(0))&e},0)}}]),e}()).KEY_STR="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},{}]},{},[14]);a(e,t,n,o,r,i,s,void 0)}("undefined"==typeof module?void 0:module,"undefined"==typeof exports?void 0:exports,"undefined"==typeof define?void 0:define,"undefined"==typeof window?void 0:window,"undefined"==typeof global?void 0:global,"undefined"==typeof self?void 0:self,this);